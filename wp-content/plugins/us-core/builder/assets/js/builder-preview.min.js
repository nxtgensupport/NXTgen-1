!function($,undefined){var _window=window,_document=document,_undefined=undefined;var abs=Math.abs,pow=Math.pow,ceil=Math.ceil,floor=Math.floor;var parent=_window.parent||{};if(!parent.$usb){return}
var $usb=parent.$usb,$usbcore=parent.$usbcore||{};['$us','$usbdata'].map(function(name){_window[name]=_window[name]||{}});_window.$ush=_window.$ush||parent.$ush||{};const _DIRECTION_={BOTTOM:'bottom',LEFT:'left',RIGHT:'right',TOP:'top',UNKNOWN:''};const _2D_AXES_={x:'x-axis',y:'y-axis'};const _CONTAINER_={ANY:'any',CHILD:'child',ROOT:'root'};const _MOUSE_EVENT_BUTTON_={MAIN:0};var _$$default={customPrefix:'us_custom_'}
var USBPreview=function(){var self=this;body=_document.body;self.fps=1000/200;self._preloaders={};self._highlights={};self.$document=$(_document);self.$body=$(body);self.$htmlBody=$('html,body',_document);self.highlight=$('.usb-hover',body)[0];self.elmMainContainer=self.getElmNode($usb.builder.mainContainer);self._events={clickedControlsHoverPanel:self._clickedControlsHoverPanel.bind(self),endDrag:self._endDrag.bind(self),maybeDrag:self._maybeDrag.bind(self),maybeStartDrag:self._maybeStartDrag.bind(self),DOMContentLoaded:self._DOMContentLoaded.bind(self),elmAnimationEnd:self._elmAnimationEnd.bind(self),elmAnimationStart:self._elmAnimationStart.bind(self),elmCopy:self._elmCopy.bind(self),elmPaste:self._elmPaste.bind(self),elmDelete:self._elmDelete.bind(self),elmDuplicate:self._elmDuplicate.bind(self),elmMove:self._elmMove.bind(self),elmSelected:self._elmSelected.bind(self),linkClickHandler:self._linkClickHandler.bind(self),stop:self._stop.bind(self),autoSetHighlightsPosition:$ush.debounce(self.setHighlightsPosition.bind(self),self.fps)};_window.onmessage=$usb._onMessage.bind(self);_window.onmouseout=$ush.debounce(function(e){e=e||_window.event;var node=e.relatedTarget||e.toElement;if(!node||$ush.toLowerCase(node.nodeName)==='html'){self._mouseLeavesIframe.call(self,e)}},1);_window.onresize=self._events.autoSetHighlightsPosition;_document.onscroll=self._events.autoSetHighlightsPosition;self.$body.attr('draggable','false');self.$document.ready(self._events.DOMContentLoaded).on('keydown',$usb._events.keydown).on('dragstart',function(){return!1}).on('mousedown','.usb-hover-panel',self._events.clickedControlsHoverPanel).on('mouseup','.ui-icon_duplicate',self._events.elmDuplicate).on('mouseup','.ui-icon_copy',self._events.elmCopy).on('mouseup','.ui-icon_paste',self._events.elmPaste).on('mouseup','.ui-icon_delete',self._events.elmDelete).on('mousedown',self._events.maybeStartDrag).on('mousemove',self._events.maybeDrag).on('mouseup',$ush.debounce(self._events.endDrag,2)).on('mouseup','[data-usbid]',$ush.debounce(self._events.elmSelected,1)).on('mousemove',$ush.debounce(self._events.elmMove,self.fps)).on('mouseleave',$ush.debounce(self._events.elmLeave,self.fps)).on('animationstart','[data-usbid]',$ush.debounce(self._events.elmAnimationStart,1)).on('animationend','[data-usbid]',$ush.debounce(self._events.elmAnimationEnd,1)).on('mouseenter','.l-header, .l-footer',$ush.debounce(self.hideHighlight.bind(self),100)).on('contentChange','.l-canvas:first',self._events.autoSetHighlightsPosition);self.$body.on('click','a',self._events.linkClickHandler);for(var handler in self._$events){if($.isFunction(self._$events[handler])){self.on(handler,self._$events[handler].bind(self))}}};var prototype=USBPreview.prototype;$.extend(prototype,$ush.mixinEvents,{postMessage:function(eventType,extraParams){parent.postMessage(JSON.stringify(['usb',eventType,extraParams]))}});$.extend(prototype,{_dragStartDistance:$usb.builder._dragStartDistance||8,_extractEventData:function(e){return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,target:e.target}},_clickedControlsHoverPanel:function(e){var self=this,elmId=$(e.currentTarget).closest('.usb-hover').data('elmid');if(!elmId){return}
self.hoveredElmId=elmId;self.hoveredElm=self.getElmNode(elmId);$(self.hoveredElm).trigger('mousedown',[e.pageX,e.pageY])},_maybeStartDrag:function(e,pageX,pageY){e.stopPropagation();var self=this;if(!$usb.panel.isShow()||$usb.builder.isParentDragging()||e.button!==_MOUSE_EVENT_BUTTON_.MAIN){return}
var target=(self.hoveredElm&&$usbcore.$hasClass(e.target,'usb-hover-panel-name'))?self.hoveredElm:self._getNearestNode(e.target);if(!target){return}
self.clearDragAssets();$usbcore.cache('iframeDrag').set({currentId:null,currentParentId:null,isDragging:!1,isParentTab:!1,startDrag:!0,startX:e.pageX||pageX||0,startY:e.pageY||pageY||0,target:target});if($ush.isFirefox){[target].concat($ush.toArray(target.getElementsByTagName('*'))).map(function(node){if(!$ush.isNode(node)||$usbcore.$hasClass(node,'usb_firefox_clip'))return;if(_window.getComputedStyle(node,null).getPropertyValue('overflow')==='hidden'){$usbcore.$addClass(node,'usb_firefox_clip')}})}},_maybeDrag:function(e){var self=this,target=e.target,currentPreviewOffset=$usb.preview.getCurrentOffset(),transit={pageX:ceil(currentPreviewOffset.x+e.pageX-_window.scrollX),pageY:ceil(currentPreviewOffset.y+e.pageY-_window.scrollY)};if(!$ush.isFirefox&&$usb.builder.isParentDragging()){self._maybeDrop(self._extractEventData(e));$usb.builder.setTransitPosition(transit.pageX,transit.pageY);return}
var dragData=$usbcore.cache('iframeDrag').data();if($.isEmptyObject(dragData)||!dragData.startDrag||!dragData.target){return}
var diffX=abs(dragData.startX-e.pageX),diffY=abs(dragData.startY-e.pageY);if(diffX>=self._dragStartDistance||diffY>=self._dragStartDistance){dragData.currentId=$usb.builder.getElmId(dragData.target);var baseCurrentId=$usb.builder.isAliasElmId(dragData.currentId)?$usb.builder.removeAliasFromId(dragData.currentId):dragData.currentId;if($usb.builder.isMode('editor')){$usbcore.cache('dragProcessData').flush();$usb.builder.setMode('drag:move');dragData.isDragging=!0;dragData.currentParentId=$usb.builder.getElmParentId(baseCurrentId);dragData.isParentTab=(!!$usb.builder.isElmTab(dragData.currentParentId)&&!$usbcore.$hasClass(self.getElmNode(dragData.currentParentId),'accordion'));$usb.builder.showTransit(dragData.currentId);$usbcore.$addClass(dragData.target,'usb_transit').$addClass(_document.body,'usb_dragging');self.hideEditableHighlight()}
if(!$usb.builder.isMode('drag:move')||(dragData.isParentTab&&!$usb.builder.isAliasElmId(dragData.currentId))||$usb.builder.isOutsideMainContainer(baseCurrentId)){self.clearDragAssets()
return}
if($usb.builder.isEmptyTempContent()){$usb.builder.saveTempContent();$usb.builder.pageData.content=(''+$usb.builder.pageData.content).replace($usb.builder.getElmShortcode(baseCurrentId),'')}
self._maybeDrop(self._extractEventData(e));$usb.builder.setTransitPosition(transit.pageX,transit.pageY)}},_maybeDrop:function(data){var self=this;if(!data||!data.target||!$usb.builder.isMode('drag:add','drag:move')||$usb.builder.hasDragScrolling()){return}
var dragData=$usbcore.cache('iframeDrag').data(),currentId=$usb.builder.isMode('drag:add')?$usb.builder.getNewElmId():dragData.currentId;var target=self._getNearestNode(data.target)||self.elmMainContainer,targetId=$usb.builder.getElmId(target),targetContainer,targetContainerId;if($usb.builder.isChildElmContainer(currentId)&&$usb.builder.isValidId(dragData.currentParentId)){targetContainerId=dragData.currentParentId;targetContainer=self.getElmNode(targetContainerId)}else if($usb.builder.isElmContainer(targetId)){targetContainerId=targetId;targetContainer=target}else{targetContainer=self._getNearestNode(target,$usb.builder.isChildElmContainer(currentId)?_CONTAINER_.ROOT:_CONTAINER_.ANY);targetContainerId=$usb.builder.getElmId(targetContainer)}
targetContainer=targetContainer||self.elmMainContainer;if($usb.builder.isRow(targetContainerId)&&($usb.builder.isRow(currentId)||$usb.templates.isTemplate(currentId))){targetContainerId=$usb.builder.mainContainer}
if($usb.builder.isAliasElmId(targetContainerId)){targetContainerId=$usb.builder.removeAliasFromId(targetContainerId)}
var children=$usb.builder.getElmChildren(targetContainerId);if($usb.builder.isElmContainer(targetContainerId)){var _parentTargetContainerId=targetContainerId;for(var i=3;i>0;i--){if(!$usb.builder.isChildElmContainer(_parentTargetContainerId)){break}
_parentTargetContainerId=$usb.builder.getElmParentId(targetContainerId)}
_parentTargetContainerId=$usb.builder.getValidContainerId(_parentTargetContainerId);var targetHeight=$ush.parseInt($ush.$rect(target).height),borderAround=(children.length&&targetHeight>=50?15:5),borderContainerToCursor=self._getBorderContainerToCursor(self.getElmNode(_parentTargetContainerId),data.clientX,data.clientY,borderAround);if(_DIRECTION_.UNKNOWN!==borderContainerToCursor){_parentTargetContainerId=$usb.builder.getValidContainerId($usb.builder.getElmParentId(_parentTargetContainerId));targetContainer=self.getElmNode(_parentTargetContainerId);targetContainerId=_parentTargetContainerId}}
var aliasId,baseCurrentId=currentId;if($usb.builder.isAliasElmId(currentId)){aliasId=$usb.builder.getAliasFromId(currentId);baseCurrentId=$usb.builder.removeAliasFromId(currentId)}
if($usb.builder.hasSameTypeParent(baseCurrentId,targetContainerId)){return}
var strictMode=($usb.builder.isChildElmContainer(baseCurrentId)||(!$usb.builder.isEmptyContent()&&$usb.builder.isMainContainer(targetContainerId)&&!($usb.builder.isRow(baseCurrentId)||$usb.templates.isTemplate(baseCurrentId))));if(!$usb.builder.canBeChildOf(baseCurrentId,targetContainerId,strictMode)){return}
var targetContainerIsTab=($usb.builder.isElmTab(targetContainerId)&&!$usbcore.$hasClass(targetContainer,'accordion')),currentIndex=0;if(_DIRECTION_.UNKNOWN!==borderContainerToCursor){children=$usb.builder.getElmChildren(targetContainerId)}
if(aliasId&&aliasId===$usb.config('aliases.tab')){children=children.map(function(id){return $usb.builder.addAliasToElmId(aliasId,id)})}
if($usb.builder.isMode('drag:move')&&$usb.builder.isColumn(baseCurrentId)){if(!self.isInsideNode(self.getElmNode(dragData.currentParentId),data.pageX,data.pageY)){return}
if($usbcore.$hasClass(dragData.target,'usb_transit')&&self.isInsideNode(dragData.target,data.pageX,data.pageY)){return}}
if(children.length){var _nearestSegment;for(var elmIndex in children){var elmId=children[elmIndex],elm=self.getElmNode(elmId);if(!elm){continue}
var elmRect=$ush.$rect(elm),elmX=(elmRect.x+_window.scrollX),elmY=(elmRect.y+_window.scrollY);elmX-=$ush.parseInt((elm.currentStyle||_window.getComputedStyle(elm)).marginLeft);if($usb.builder.isColumn(baseCurrentId)&&!(data.pageY>=elmY&&data.pageY<=(elmY+elmRect.height))){continue}
var _segmentLength=Math.sqrt(pow(data.pageY-elmY,2)+pow(data.pageX-elmX,2));if(!_nearestSegment||_nearestSegment>_segmentLength){_nearestSegment=_segmentLength;currentIndex=parseInt(elmIndex)}}}
if(currentIndex===children.length-1||$usb.builder.isColumn(baseCurrentId)){var only_x_axis=$usb.config('moving_only_x_axis',[]).indexOf($usb.builder.getElmName(dragData.parentId))>-1;if($usb.builder.isElmTab(targetContainerId)&&$usbcore.$hasClass(targetContainer,'accordion')){only_x_axis=!1}
var currentCursorDirectionInTarget=self._getCurrentCursorDirectionInTarget(self.getElmNode(children[currentIndex]),data.clientX,data.clientY,_2D_AXES_[only_x_axis?'x':'y']);if($usbcore.indexOf(currentCursorDirectionInTarget,[_DIRECTION_.BOTTOM,_DIRECTION_.RIGHT])>-1){currentIndex+=1}}
if(self.isHiddenTab(targetContainerId)){currentIndex=children.length}
if(dragData.lastFoundContainer!==targetContainer){$usbcore.$removeClass(dragData.lastFoundContainer,'usb_dropcontainer').$addClass(targetContainer,'usb_dropcontainer');dragData.lastFoundContainer=targetContainer}
if($usb.builder.isAliasElmId(targetContainerId)){targetContainerId=$usb.builder.removeAliasFromId(targetContainerId)}
dragData.parentId=targetContainerId;dragData.currentId=baseCurrentId;dragData.currentIndex=currentIndex;if($ush.isFirefox){$usbcore.cache('drag').set({parentId:targetContainerId,currentId:currentId,currentIndex:currentIndex})}
var insert=$usb.builder.getInsertPosition(targetContainerId,currentIndex);if($usbcore.comparePlainObject(insert,dragData.lastInsert)){return}
dragData.lastInsert=$ush.clone(insert);if($usb.builder.isColumn(currentId)){dragData.place=self.getElmNode(currentId)}else{$usbcore.$remove(dragData.place);dragData.place=_document.createElement('div');dragData.place.className='usb_dropplace';var isHorizontalWrapper=($usb.builder.getElmName(targetContainerId)==='hwrapper');if($usb.builder.isRootElmContainer(targetContainerId)||isHorizontalWrapper||dragData.isParentTab){if(isHorizontalWrapper){dragData.place.style.height=$ush.$rect(targetContainer).height+'px'}}}
if(dragData.isParentTab&&aliasId){if($usb.builder.isValidId(insert.parent)){insert.parent=($usbcore.indexOf(insert.position,['prepend','append'])>-1)?self.getElmNode(currentId).parentNode||targetContainer:$usb.builder.addAliasToElmId(aliasId,insert.parent)}}
self.trigger('insertElm',[insert.parent,insert.position,dragData.place])},_endDrag:function(e){var self=this;if(!$usb.builder.isMode('drag:add','drag:move','editor')){return}
if(!$ush.isFirefox){self._events.stop(e)}
if($usb.builder.isMode('drag:add','drag:move')){self.hoveredElm=null}
var dragData=$usbcore.cache('iframeDrag').data();if($usb.builder.isAliasElmId(dragData.currentId)){dragData.currentId=$usb.builder.removeAliasFromId(dragData.currentId)}
if($usb.builder.isParentDragging()){$usbcore.cache('drag').set({parentId:dragData.parentId,currentId:dragData.currentId,currentIndex:dragData.currentIndex});self.postMessage('builder.endDrag');return}
$usb.builder.setMode('editor');if(!dragData.startDrag||!dragData.isDragging){self.clearDragAssets();if(!dragData.isDragging&&$usbcore.$hasClass(e.target,'usb-hover-panel-name')){self.hideEditableHighlight();var $highlight=$(e.target).closest('.usb-hover');if($highlight.length){var elmId=$highlight.data('elmid');self.hoveredElm=self.getElmNode(elmId);$(self.hoveredElm).trigger('mouseup')}}
return}
$usb.builder.restoreTempContent();if(!!dragData.parentId&&!!dragData.currentId){$usb.builder.moveElm(dragData.currentId,dragData.parentId,dragData.currentIndex||0);if($usb.builder.isElmSection(dragData.parentId)){self.openSectionById(dragData.parentId)}
$us.$canvas.trigger('contentChange')}
self.clearDragAssets()},clearDragAssets:function(){var self=this;var dragData=$usbcore.cache('iframeDrag').data();if($.isEmptyObject(dragData)){return}
$usbcore.$removeClass(dragData.target,'usb_transit').$removeClass(dragData.lastFoundContainer,'usb_dropcontainer').$removeClass(_document.body,'usb_dragging');if(!$usb.builder.isColumn(dragData.currentId)){$usbcore.$remove(dragData.place)}
$usb.builder.hideTransit();$usbcore.cache('iframeDrag').flush()
if($usb.builder.isMode('drag:move')){if(_window.getSelection){_window.getSelection().removeAllRanges()}else if(_document.selection){_document.selection.empty()}}},_scrollDragging:$ush.debounce(function(direction,acceleration){var self=this,scrollHeight=$ush.parseInt(_document.body.scrollHeight),scrollTo=_undefined,scrollTop=$ush.parseInt(_window.scrollY);if(self.$htmlBody.is(':animated')){self.$htmlBody.stop(!0)}
if(direction===_DIRECTION_.TOP&&scrollHeight&&scrollTop>0){scrollTo=0}
else if(direction===_DIRECTION_.BOTTOM&&scrollTop<$ush.parseInt(scrollHeight-_window.innerHeight)){scrollTo=scrollHeight}
if(!$.isNumeric(scrollTo)){$usb.builder.removeDragScrollData();return}
var duration=2000,maxAcceleration=4;acceleration=$ush.parseInt(acceleration);if(acceleration>maxAcceleration){acceleration=maxAcceleration}
self.$htmlBody.animate({scrollTop:scrollTo},{duration:floor(duration/ ( acceleration || /*default*/1)),complete:$usb.builder.stopDragScrolling.bind($usb)});self.hideHighlight()},1)});$.extend(prototype,{showHighlight:function(){var self=this;if(!$usb.builder.isMode('editor')||!$usb.builder.isValidId(self.hoveredElmId)){return}
var parentId=self.hoveredElmId,iteration=0;if($usb.builder.isAliasElmId(parentId)){parentId=$usb.builder.removeAliasFromId(parentId)}
while(parentId!==$usb.builder.mainContainer&&parentId!==null){if(iteration++>=1000){break}
self._createHighlight(parentId);var item=self._highlights[parentId];if($(self.getElmNode(parentId)).is(':visible')){item.active=!0;item.highlight.style.display='block'}
parentId=$usb.builder.getElmParentId(parentId)}
self.setHighlightsPosition.call(self)},hideHighlight:function(){var self=this;if($.isEmptyObject(self._highlights)){return}
for(var elmId in self._highlights){var item=self._highlights[elmId];item.active=!1;item.highlight.style.display='none'}
self.hoveredElm=null;self.hoveredElmId=null},setHighlightsPosition:function(){var self=this;if(!$usb.builder.isMode('editor')||$.isEmptyObject(self._highlights)){return}
for(var elmId in self._highlights){if(!$usb.builder.isValidId(elmId)){continue}
var item=self._highlights[elmId],elm=self.getElmNode(elmId);if(!$ush.isNode(elm)||(!item.active&&!item.editable)){continue}
var negativeTop=elm.offsetTop<0?abs(elm.offsetTop):0,negativeLeft=elm.offsetLeft<0?abs(elm.offsetLeft):0,elmRect=$ush.$rect(elm),cssProps={height:elmRect.height-negativeTop,left:elmRect.left+negativeLeft+(_window.pageXOffset||elm.scrollLeft),top:elmRect.top+negativeTop+(_window.pageYOffset||elm.scrollTop),width:elmRect.width-negativeLeft};$(item.highlight).css(cssProps);$usbcore.$toggleClass(item.highlight,'small',(elmRect.width<75))}},showEditableHighlight:function(id){var self=this;if(!$usb.builder.isValidId(id)){return}
self.hideEditableHighlight();var item=self._highlights[id];if(!item){self.hideHighlight();item=self._createHighlight(id);if(item){item.active=!0}
self.setHighlightsPosition()}
if(item){item.editable=!0;$usbcore.$addClass(item.highlight,'usb_editable')}},hideEditableHighlight:function(){var self=this;if($.isEmptyObject(self._highlights)){return}
var id=''+arguments[0],highlights=self._highlights;if(!!id&&self.hasEditableHighlight(id)){highlights=[highlights[id]]}
for(var elmId in highlights){var item=highlights[elmId];if(!item.editable){continue}
$usbcore.$removeClass(item.highlight,'usb_editable');}
self.selectedElmId=null},hasEditableHighlight:function(id){return!!(this._highlights[id]||{}).editable},_getMutationObserver:function(id){var target,self=this;if(!$usb.builder.isValidId(id)||!(target=self.getElmNode(id))){return}
var observer=new MutationObserver($ush.debounce(self.setHighlightsPosition.bind(self),1));observer.observe(target,{characterData:!0,childList:!0,subtree:!0});return observer},_createHighlight:function(id){var self=this;if(!$usb.builder.isValidId(id)||self._highlights[id]||!$ush.isNode(self.highlight)||$usb.builder.isAliasElmId(id)){return null}
var highlightElm=self.highlight.cloneNode(!0),node=self.getElmNode(id),dataHighlight=$ush.toPlainObject($usbcore.$attr(node,'data-usb-highlight'));if(!$.isPlainObject(dataHighlight)){dataHighlight={}}
highlightElm.querySelector('.usb-hover-panel-name').innerText=$usb.builder.getElmTitle(id);if(dataHighlight.edit_permalink&&dataHighlight.edit_label){var node=highlightElm.querySelector('.usb-hover-panel-edit');if(node){node.innerText=dataHighlight.edit_label;$usbcore.$attr(node,'href',dataHighlight.edit_permalink)}}
$usbcore.$attr(highlightElm,'data-elmid',id).$addClass(highlightElm,'elm_'+$usb.builder.getElmType(id)).$toggleClass(highlightElm,'usb_disable_controls',!!dataHighlight.disable_controls);self.highlight.after(highlightElm);var zIndex=9999;if($usb.builder.isChildElmContainer(id)){zIndex-=1}else if($usb.builder.isRootElmContainer(id)){zIndex-=2}
highlightElm.style.zIndex=zIndex;return self._highlights[id]={active:!1,editable:!1,highlight:highlightElm,MutationObserver:self._getMutationObserver(id)}},removeHighlights:function(force){var self=this;if($.isEmptyObject(self._highlights)){return}
for(var elmId in self._highlights){if(!$usb.builder.isValidId(elmId)){continue}
if(!!force||null===self.getElmNode(elmId)){var data=self._highlights[elmId];if(data.MutationObserver instanceof MutationObserver){data.MutationObserver.disconnect()}
$usbcore.$remove(data.highlight);delete self._highlights[elmId]}}}});$.extend(prototype,{_stop:function(e){e.preventDefault();e.stopPropagation()},_DOMContentLoaded:function(){this.$body.addClass('usb_content_ready')},_linkClickHandler:function(e){var self=this,$target=$(e.currentTarget),href=$ush.toLowerCase($target.attr('href')||'');if(href.charAt(0)=='#'||href.substr(0,'javascript:'.length)=='javascript:'||$target.is('[ref=magnificPopup]')||$target.hasClass('.w-tabs-item')){return}
self._events.stop(e);_window.open(href,'_blank')},_elmAnimationStart:function(e){var self=this;if(!$usbcore.$attr(e.target,'data-usbid')){return}
if(self.selectedElmId&&$usb.builder.getElmType(self.selectedElmId)!=='us_grid'){self.hideEditableHighlight()}},_elmAnimationEnd:function(e){var self=this;if(!$usbcore.$attr(e.target,'data-usbid')){return}
if($usb.builder.isValidId(self.selectedElmId)&&$usb.builder.getElmType(self.selectedElmId)!=='us_grid'){self.showEditableHighlight(self.selectedElmId);self.setHighlightsPosition()}},_mouseLeavesIframe:function(e){var self=this;if($usb.panel.isShow()){self.hideHighlight()}},_elmSelected:function(e){var self=this;if(!$usb.builder.isMode('editor')||!$usb.panel.isShow()){return}
var node=self._getNearestNode(e.target);if(!$ush.isNode(node)){return}
var id=$usb.builder.getElmId(node);if($usb.builder.isAliasElmId(id)){id=$usb.builder.removeAliasFromId(id)}
self.selectedElmId=id;self.postMessage('builder.elmSelected',id);self.postMessage('navigator.scrollTo',id);self.showEditableHighlight(id)},_elmMove:function(e){var self=this;if(!$usb.panel.isShow()){return}
var elm=self._getNearestNode(e.target);if(elm&&elm!==self.hoveredElm){self.hideHighlight();self.hoveredElm=elm;self.hoveredElmId=$usb.builder.getElmId(elm);self.showHighlight()}},_elmLeave:function(e){var self=this;if(!$usb.panel.isShow()){return}
if($ush.isNode(self._getNearestNode(e.target))){self.hoveredElm=null;self.hoveredElmId=null}},_elmDuplicate:function(e){var self=this,$highlight=$(e.currentTarget).closest('.usb-hover'),elmId=$highlight.data('elmid');if(!elmId){return}
self.postMessage('navigator.showPreloader',elmId);self.postMessage('builder.elmDuplicate',elmId)},__removeClassInCopiedElm:$ush.debounce($ush.fn,1000*4),_elmCopy:function(e){var self=this,$target=$(e.currentTarget),$highlight=$target.closest('.usb-hover'),elmId=$highlight.data('elmid');if(!elmId){return}
self.postMessage('builder.elmCopy',elmId);$target.addClass('copied');self.__removeClassInCopiedElm(function(){$target.removeClass('copied')})},_elmPaste:function(e){var self=this,$target=$(e.currentTarget),$highlight=$target.closest('.usb-hover'),elmId=$highlight.data('elmid');if(elmId){self.postMessage('builder.elmPaste',elmId)}},_elmDelete:function(e){var self=this,$highlight=$(e.currentTarget).closest('.usb-hover'),elmId=$highlight.data('elmid');if(!elmId){return}
$usbcore.$remove(self._highlights[elmId].highlight||null);delete self._highlights[elmId];self.postMessage('builder.elmDelete',elmId)}});$.extend(prototype,{__startAnimation:$ush.debounce(function(node){$usbcore.$addClass(node,'start')},1),_addDesignOptions:function(id,jsoncss,specificClasses){var self=this,$style;if(!$usb.builder.isValidId(id)){return}
jsoncss+='';_document.querySelectorAll('style[data-for="'+id+'"][data-classname]').forEach(function(style,i){if(i===0){return $style=style}
$usbcore.$remove(style)});var getAnimateProps=function(node){if(!$ush.isNode(node)){return}
var style=_window.getComputedStyle(node),name=style.getPropertyValue('animation-name'),delay=style.getPropertyValue('animation-delay');if(name&&name!=='none'){return name+delay}
return};var node=self.getElmNode(id);if($usb.builder.getElmType(id)==='us_btn'&&$ush.isNode(node)){node=node.firstChild||node}
if(!$style){var
customPrefix=$usb.config('designOptions.customPrefix',_$$default.customPrefix),className=$ush.uniqid(customPrefix);if(!$ush.isNode(node))return;$style=$('<style data-for="'+id+'" data-classname="'+className+'"></style>')[0];node.before($style);if(node.className.indexOf(customPrefix)>-1){node.className=node.className.replace(new RegExp('('+$ush.escapePcre(customPrefix)+'\\w+)'),'')}
$usbcore.$addClass(node,className)}
var hasAnimateName=jsoncss.indexOf('animation-name')>-1,oldAnimateProp;if($style){var _className=$usbcore.$attr($style,'data-classname');if(hasAnimateName){oldAnimateProp=getAnimateProps(node)}
$style.innerText=self._compileDesignOptions(_className,jsoncss)}
if(hasAnimateName){var currentAnimateProps=getAnimateProps(node);if(currentAnimateProps&&currentAnimateProps!==oldAnimateProp){$usbcore.$addClass(node,'us_animate_this');$usbcore.$removeClass(node,'start');self.__startAnimation(node)}}else if($usbcore.$hasClass(node,'us_animate_this')){$usbcore.$removeClass(node,'us_animate_this start')}
self._toggleDesignSpecificClasses.apply(self,arguments)},_removeDesignForElmsNotExist:function(){var self=this;_document.querySelectorAll('style[data-for]').forEach(function(style){var id=$usbcore.$attr(style,'data-for');if(id&&null===self.getElmNode(id)){$usbcore.$remove(style)}})},_removeDesignById:function(id){_document.querySelectorAll('style[data-for="'+id+'"]').forEach(function(style){$usbcore.$remove(style)})},_compileDesignOptions:function(className,jsoncss){var self=this,collections={};jsoncss=$ush.toPlainObject(jsoncss);if($.isEmptyObject(jsoncss)){return ''}
$usb.config('responsiveStates',[]).map(function(responsiveState){if(!!jsoncss[responsiveState]){collections[responsiveState]=self._normalizeJsoncss(jsoncss[responsiveState])}});var result='';for(var responsiveState in collections){if($.isEmptyObject(collections[responsiveState])){continue}
var cssCode='',collection=self._applyMaskToBackgroundCss(collections[responsiveState]),breakpoint=$usb.config('designOptions.breakpoints.'+responsiveState,'');for(var prop in collection){var propValue=collection[prop];if(!prop||!propValue){continue}
cssCode+=prop+':'+propValue+'!important;';if(prop==='animation-name'&&propValue==='none'){cssCode+='opacity:1!important;'}}
if(cssCode){cssCode='.'+className+'{'+cssCode+'}'}
result+=(breakpoint)?'@media '+breakpoint+' {'+cssCode+'}':cssCode}
return result},_normalizeJsoncss:function(options){var self=this;if($.isEmptyObject(options)){return options}
if(!!options['background-image']){var url=$usb.getAttachmentUrl(options['background-image']);if(!!url){options['background-image']='url('+url+')'}}
for(var prop in options){if(!prop||!options[prop]){continue}
var value=options[prop];if(/(^color|-color$)/.test(prop)&&(''+value).charAt(0)==='_'){value=self.getColorValue(value);if(prop=='color'&&self._isCssGradient(value)){value=value.replace('-grad','')}
options[prop]=value}
if(prop==='font-family'){var font_name=$usb.config('designOptions.fontVars.'+value,value);if(value.indexOf(' ')>-1&&value.indexOf(',')==-1){font_name='"'+font_name+'"'}
options[prop]=font_name}
if(prop==='border-style'){['left','top','right','bottom'].map(function(position){var borderWidth=options['border-'+position+'-width'];if(!$ush.isUndefined(borderWidth)&&borderWidth!==''){options['border-'+position+'-style']=''+value}});delete options[prop]}
if(prop==='font-height'){if(!!value){options['line-height']=value}
delete options[prop]}}
if(!!options&&(!!options['box-shadow-h-offset']||!!options['box-shadow-v-offset']||!!options['box-shadow-blur']||!!options['box-shadow-spread'])){var _boxShadow=[];['h-offset','v-offset','blur','spread','color'].map(function(key){var value=options['box-shadow-'+key];if($ush.isUndefined(value)){value=(key==='color')?'currentColor':'0'}
_boxShadow.push(value);delete options['box-shadow-'+key]});if(_boxShadow.length){options['box-shadow']=_boxShadow.join(' ')}}
if(!!options&&(!!options['text-shadow-h-offset']||!!options['text-shadow-v-offset']||!!options['text-shadow-blur'])){var _textShadow=[];['h-offset','v-offset','blur','color'].map(function(key){var value=options['text-shadow-'+key];if($ush.isUndefined(value)){value=(key==='color')?'currentColor':'0'}
_textShadow.push(value);delete options['text-shadow-'+key]});if(_textShadow.length){options['text-shadow']=_textShadow.join(' ')}}
return options},_applyMaskToBackgroundCss:function(collection){var self=this;collection=$.extend({},collection||{});var propNames='color|image|repeat|attachment|position|size'.split('|')||[],assignedProps={},backgroupdPropValue='';for(var i in propNames){var name=propNames[i],cssName='background-'+name;if(!!collection[cssName]){assignedProps[name]=collection[cssName];delete collection[cssName]}}
var _gradient='';if(!!assignedProps.image&&self._isCssGradient(assignedProps.color)){_gradient=assignedProps.color;delete assignedProps.color}
if(!!assignedProps.size){if(!assignedProps.position){assignedProps.position='left top'}
assignedProps.size='/ '+assignedProps.size}
for(var i in propNames){var name=propNames[i];if(!!assignedProps[name]){backgroupdPropValue+=' '+assignedProps[name]}}
if(_gradient){backgroupdPropValue+=', '+_gradient}
collection.background=backgroupdPropValue.trim();return collection},_isCssGradient:function(value){value+='';return value.indexOf('gradient')>-1||/\s?var\(.*-grad\s?\)$/.test(value)},_toggleDesignSpecificClasses:function(id,jsoncss,specificClasses){var self=this,toggleClasses={};if(!$.isPlainObject(specificClasses)){return toggleClasses}
var node=self.getElmNode(id);if($usb.builder.getElmType(id)==='us_btn'&&$ush.isNode(node)){node=node.firstChild||node}
if(jsoncss){jsoncss=unescape(''+jsoncss)||'{}'}
for(var prop in specificClasses){var state=(jsoncss.indexOf('"'+prop+'"')>-1);$usbcore.$toggleClass(node,specificClasses[prop],state)}},});$.extend(prototype,{_getBorderContainerToCursor:function(target,clientX,clientY,borderAround){var self=this;if(!$ush.isNode(target)||target===self.elmMainContainer||!$.isNumeric(clientX)||!$.isNumeric(clientY)){return _DIRECTION_.UNKNOWN}
clientX+=_window.scrollX;clientY+=_window.scrollY;var elmRect=$ush.$rect(target),elmLeft=floor(abs(elmRect.x)+_window.scrollX),elmTop=floor(abs(elmRect.y)+_window.scrollY),elmRight=floor(elmLeft+elmRect.width),elmBottom=floor(elmTop+elmRect.height);if(!$.isNumeric(borderAround)){borderAround=5}
if(clientY>elmTop&&clientY<=(elmTop+borderAround)){return _DIRECTION_.TOP}
else if(clientY<elmBottom&&clientY>=(elmBottom-borderAround)){return _DIRECTION_.BOTTOM}
else if(clientX>elmLeft&&clientX<=(elmLeft+borderAround)){return _DIRECTION_.LEFT}
else if(clientX<elmRight&&clientX>=(elmRight-borderAround)){return _DIRECTION_.RIGHT}
return _DIRECTION_.UNKNOWN},_getCurrentCursorDirectionInTarget:function(target,clientX,clientY,axis){if(!$ush.isNode(target)){return _DIRECTION_.UNKNOWN}
var self=this,RAD_TO_DEG=180/Math.PI,rect=$ush.$rect(target),center={x:rect.width/2+rect.left,y:rect.height/2+rect.top},vector={x:clientX-center.x,y:clientY-center.y},vectorLength=Math.sqrt(vector.x*vector.x+vector.y*vector.y),direction={x:vector.x/vectorLength,y:vector.y/vectorLength},angle=Math.atan2(direction.y,direction.x)*RAD_TO_DEG;if($usbcore.indexOf(axis,_2D_AXES_)<0){axis=_2D_AXES_.y}
if(axis===_2D_AXES_.x){return(angle>-180&&angle<=-130||angle<=180&&angle>130)?_DIRECTION_.LEFT:_DIRECTION_.RIGHT}
return(angle<0)?_DIRECTION_.TOP:_DIRECTION_.BOTTOM},isInsideNode:function(node,pageX,pageY){if(!$ush.isNode(node)||$ush.isUndefined(pageX)||$ush.isUndefined(pageY)){return!1}
var nodeRect=$ush.$rect(node),offsetTop=(nodeRect.x+_window.scrollX),offsetLeft=(nodeRect.y+_window.scrollY);return(pageX>=offsetTop&&pageX<=(offsetTop+nodeRect.width)&&pageY>=offsetLeft&&pageY<=(offsetLeft+nodeRect.height))},_getNearestNode:function(node,asContainer){var self=this,args=arguments,foundId;if(!$ush.isNode(node)){return null}
while(!(foundId=$usbcore.$attr(node,'data-usbid'))){if(!node.parentNode){return null}
node=node.parentNode}
if(!asContainer){return self.getElmNode(foundId||$usb.builder.mainContainer)}
if($usbcore.indexOf(asContainer,_CONTAINER_)<0){$usb.log('Error: The asContainer value is invalid:',args);return null}
var _filter=function(currentId){var args=arguments,parentId=$usb.builder.getElmParentId(currentId);if(!parentId){return null}
var recursionLevel=$ush.parseInt(args[1]);if(recursionLevel>=20){$usb.log('Notice: Exceeded number of levels in recursion:',args);return null}
if((asContainer===_CONTAINER_.ANY&&$usb.builder.isElmContainer(parentId))||(asContainer===_CONTAINER_.ROOT&&$usb.builder.isRootElmContainer(parentId))||(asContainer===_CONTAINER_.CHILD&&$usb.builder.isChildElmContainer(parentId))){return parentId}
return _filter(parentId,recursionLevel++)};var foundId=_filter(foundId)||$usb.builder.mainContainer;return self.getElmNode(foundId)},getColorValue:function(value){if((''+value).indexOf('_')>-1){return $usb.config('designOptions.colorVars.'+value,value)}
return value},_getTargetElm:function(targetId,position){var self=this;if(!targetId||!$usb||$usbcore.indexOf(position,['before','prepend','append','after'])<0){return}
var isMainContainer=$usb.builder.isMainContainer(targetId),$targetElm=$(self.getElmNode(isMainContainer?$usb.builder.mainContainer:targetId));if($usbcore.indexOf(position,['before','after'])>-1){return $targetElm}
if(!isMainContainer&&$targetElm.length){var elmType=$usb.builder.getElmType(targetId),elmRootSelector=$usb.config('rootContainerSelectors.'+elmType);if(elmRootSelector){$targetElm=$(''+elmRootSelector,$targetElm).first();if(!$targetElm.length){$usb.log('Error: No element set for container `%s` in rootContainerSelectors'.replace('%s',elmType))}}}
return $targetElm},getElmNode:function(id){if(!id){return}
var self=this,ids=id;if(!$.isArray(ids)){ids=[ids]}
ids=ids.filter(function(id){return $usb.builder.isValidId(id)||$usb.builder.isMainContainer(id)});ids=ids.map(function(id){return '[data-usbid="'+id+'"]'});if($.type(id)==='string'&&ids.length===1){return _document.querySelector(ids[0])}
if($.isArray(id)&&ids.length){var nodes=_document.querySelectorAll(ids.join(','));return $ush.toArray(nodes)}
return null},getElmOuterHtml:function(id){var node=this.getElmNode(id);if($ush.isNode(node)){return((_document.querySelector('style[data-for="'+id+'"]')||{}).outerHTML||'')+node.outerHTML}
return ''},isHiddenTab:function(id){var self=this;return $usb.builder.isElmSection(id)&&!$('.w-tabs-section-content:first',self.getElmNode(id)).is(':visible')},openSectionById:function(id){var self=this;if(self.isHiddenTab(id)){$('.w-tabs-section-header:first',self.getElmNode(id)).trigger('click')}},scrollToOutsideElm:function(id){var self=this;if(!$usb.builder.isValidId(id)){return}
var node=self.getElmNode(id);if(!$ush.isNode(node)){return}
var rect=$ush.$rect(node);if(!(rect.top<0||rect.bottom>(_window.innerHeight||rect.height))){return}
if(!$ush.isUndefined($us.scroll)&&$.isFunction($us.scroll.scrollTo)){$us.scroll.scrollTo($(node),!0)}
else{self.$htmlBody.stop(!0,!1).animate({scrollTop:$(node).offset().top+'px'})}},__setHighlightsPosition:$ush.debounce(function(){this.setHighlightsPosition()},10),_$events:{changeSwitchPanel:function(){var self=this;self.$body.toggleClass('usb_preview',$usb.panel.isShow())},showPreloader:function(targetId,position,isContainer,id){var self=this;if($ush.isUndefined(position)){$(self.getElmNode(targetId)).addClass($usb.config('className.elmLoad',''));return}
if(targetId==='container'&&!$ush.isUndefined(self._preloaders[id||targetId])){return}
var $preloader=$('<div class="g-preloader type_1 for_usbuilder"></div>').toggleClass('usb-loading-container',!!isContainer);self._preloaders[id||targetId]=$preloader.get(0);self.trigger('insertElm',[targetId,position,$preloader])},hidePreloader:function(id){var self=this;if(!!id&&self._preloaders[id]){$usbcore.$remove(self._preloaders[id]);delete self._preloaders[id]}},removeHtmlById:function(removeId){var self=this;if(!removeId){return}
if(!$.isArray(removeId)){removeId=[removeId]}
var nodes=self.getElmNode(removeId)||[];if(!nodes.length){return}
nodes.map(function(node){if(!$ush.isNode(node)){return}
var $node=$(node),$tabs=$node.closest('.w-tabs');if($usb.builder.isUpdateIncludeParent(node)){$('[aria-controls="content-'+$node.attr('id')+'"]:first',$tabs).remove();$tabs.find('.w-tabs-list a:first, .w-tabs-section-title:first').trigger('click')}
$node.trigger('usb.removeHtml').remove();self.removeHighlights();self._removeDesignForElmsNotExist()})},insertElm:function(parent,position,html,scrollIntoView){var self=this,$parentElm=!$ush.isNode(parent)?self._getTargetElm(parent,position):$(parent);if($parentElm instanceof $){var $html=$(html);$parentElm[position]($html);$('[data-usbid]',$html).each(function(_,node){self.trigger('maybeInitElmJS',[$usbcore.$attr(node,'data-usbid')])});if(scrollIntoView){$html[0].scrollIntoView();$(('[class*="us_animate_"]:not(.start)'),$html).addClass('start')}}},moveElm:function(parent,position,elmId){var self=this,$parentElm=self._getTargetElm(parent,position),$elm=$(self.getElmNode(elmId));if($parentElm instanceof $&&$elm.length){$parentElm[position]($elm);var $style=$('style[data-for="'+elmId+'"]:first',self.$body);if($style.length){$elm.before($style)}
var parentId=$usb.builder.getElmParentId(elmId);if(parentId&&$usb.builder.isElmTab(parentId)){var elmNode=self.getElmNode($usb.builder.addAliasToElmId('tab-button',elmId)),parentNode=$usb.builder.isElmTab(parent)?elmNode.parentNode:self.getElmNode($usb.builder.addAliasToElmId('tab-button',parent));$(parentNode)[position](elmNode)}}},updateSelectedElm:function(id,html){if(!id){return}
var self=this,node=self.getElmNode(id);if(!$ush.isNode(node)){return}
self._removeDesignById(id);node.outerHTML=''+html;self.trigger('maybeInitElmJS',[id]);self.__setHighlightsPosition()},updatePageCustomCss:function(css){var self=this,keyCustomCss=$usb.config('settings.keyCustomCss','usb_post_custom_css');var $style=$('style[data-type="'+keyCustomCss+'"]',self.$document);if(!$style.length){$style=$('<style data-type="'+keyCustomCss+'">');$('head',self.$document).append($style)}
$style.text(css||'')},updateElmContent:function(selector,content,method){if($usbcore.indexOf(method,['text','html'])<0){method='text'}
$(selector,this.$document)[method](''+content)},maybeInitElmJS:function(targetId){var self=this,initMethods=$.isPlainObject(_window.$usbdata.elmsInitJSMethods)?_window.$usbdata.elmsInitJSMethods:{},elmType=$usb.builder.getElmType(targetId);if(!$ush.isUndefined(initMethods[elmType])&&$.isFunction(initMethods[elmType])){var $node=$(self.getElmNode(targetId));if($node.length&&$usbcore.indexOf(elmType,$usb.config('shortcode.with_wrappers',[]))>-1){$node=$(':first-child',$node)}
initMethods[elmType]($node)}},onPreviewParamChange:function(targetId,instructions,value,fieldType,isResponsiveValue){var self=this,$target=$(self.getElmNode(targetId));if(!$target.length){return}
var states=$usb.config('responsiveStates',[])||'';if($ush.isUndefined(instructions[0])){instructions=[instructions||{}]}
if(fieldType==='color'&&(''+value).charAt(0)==='_'){value=self.getColorValue(value)}
for(var i in instructions){var instruction=instructions[i],$elm=!$ush.isUndefined(instruction.elm)?$target.find(instruction.elm):$target;if(!$elm.length){continue}
if(!$ush.isUndefined(instruction.mod)){var mod=''+instruction.mod,escapeMod=$ush.escapePcre(mod),pcre=new RegExp('((^|\\s)(('+states.join('|')+')_)?'+escapeMod+'[a-zA-Z0-9\_\-]+)','g');$elm.each(function(_,elm){elm.className=elm.className.replace(pcre,'')});if(isResponsiveValue){$.each(value||[],function(state,value){if(value){$elm.addClass(state+'_'+mod+'_'+value)}})}else{value=$.isArray(value)?value:(''+value).split(',');$.each(value||[],function(_,value){if(value){$elm.addClass(mod+'_'+value)}})}}
if(!$ush.isUndefined(instruction.css)){if('font-family'===instruction.css){value=$usb.config('designOptions.fontVars.'+value,value)}
$elm.css(instruction.css,value);if($ush.isSafari&&'grid-gap'===instruction.css){$elm.css('opacity','0.99');$ush.timeout(function(){$elm.css('opacity','')},50)}}
if(!$ush.isUndefined(instruction.attr)){var attr_name=''+instruction.attr;switch(attr_name){case 'html':$elm.html(value);break;case 'text':$elm.text(value);break;case 'tag':$elm.replaceWith(function(){var that=this,$tag=$('<'+value+'>').html($(that).html());for(var i=that.attributes.length-1;i>=0;-- i){var item=that.attributes[i];$tag.attr(item.name,item.value)}
return $tag});break;case 'class':$elm.removeClass($elm.data('last-classname')||'').addClass(value).data('last-classname',value);break;case 'onclick':if(value){value='try{'+value+'}catch(err){console.error(err)}'}
default:$elm.attr(attr_name,value)}}
if(!$ush.isUndefined(instruction.toggle_atts)){for(var k in instruction.toggle_atts){if(value==!0){$elm.attr(k,instruction.toggle_atts[k])}else{$elm.removeAttr(k)}}}
if(!$ush.isUndefined(instruction.toggle_class)){$elm.toggleClass(instruction.toggle_class,!!value)}
if(!$ush.isUndefined(instruction.toggle_class_inverse)){$elm.toggleClass(instruction.toggle_class_inverse,!value)}
if(!$ush.isUndefined(instruction.design_options)){self._addDesignOptions(targetId,value,instruction.design_options)}
if(!$ush.isUndefined(instruction.refresh)){$elm.replaceWith($elm.clone())}}
$target.trigger('usb.contentChange');self.setHighlightsPosition()},onParentEventData:function(method,data){if(!method){return}
data=$.extend({eventX:0,eventY:0,clientX:0,clientY:0,pageX:0,pageY:0},data||{});data.target=_document.elementFromPoint(data.eventX,data.eventY);this.trigger('doAction',[method,data])},doAction:function(name,args){var self=this;if(!name||!$.isFunction(self[name])){return}
args=args||[];self[name].apply(self,$.isArray(args)?args:[args])},vcColumnChanged:function(rootContainerId){var self=this;if(!rootContainerId||!$usb.builder.isValidId(rootContainerId)){return}
var columns=$usb.builder.getElmChildren(rootContainerId);$(columns.map(function(usbid){return '[data-usbid="'+usbid+'"]'}).join(','),self.$body).each(function(i,column){var width=''+$usb.builder.getElmValue(columns[i],'width');if(/(\d+)\/(\d+)/.test(width)){var isGridColumnsLayout=$usb.config('isGridColumnsLayout',!1);if(!isGridColumnsLayout&&width.indexOf('/5')!=-1){}else{var parts=width.split('/');width=ceil(parts[0]/ parts[ /*y*/1]*12)}}
if(!width){return}
for(var i=3;i>-1;i--){var prefix=['xs','sm','md','lg'][i],matches=(new RegExp('(vc_col)-('+prefix+')-[0-9\\/]+')).exec(column.className);if(!matches){continue}
column.className=column.className.replace(matches[0],matches[1]+'-'+prefix+'-'+width)}})}}});$(function(){_window.$usbp=new USBPreview})}(jQuery)