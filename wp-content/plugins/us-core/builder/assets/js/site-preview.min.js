!function($,undefined){var _document=document,_history=history,_location=location,_window=window;var parent=_window.parent||{};_window.$ush=_window.$ush||parent.$ush||{};if(!parent.$usb){$usb.reloadPreview();return}
var $usb=parent.$usb,$usbcore=parent.$usbcore||{};const _COOKIE_NAME_FOR_PREVIEW_OPTIONS_='usb_preview_site_options';var USBSitePreview=function(){var self=this;var siteParam=$usb.config('preview.url_site_param');if(siteParam&&(_document.referrer+'').indexOf(siteParam)>-1){var siteNonce=$usb.config('preview.url_site_nonce','');var url=new URL(location);url.searchParams.set(siteParam,siteNonce);_history.pushState({},'',url.toString())}
_window.onmessage=$usb._onMessage.bind(self);_window.onbeforeunload=function(){if(!$usb.iframeIsReady){return}
$usb.preview.showPreloader()};self.$document=$(_document);self._events={clearCookies:self._clearCookies.bind(self),onPreviewChange:self._onPreviewChange.bind(self),};self.$document.on('keydown',$usb._events.keydown);self.on('clearCookies',self._events.clearCookies).on('onPreviewChange',self._events.onPreviewChange)}
$.extend(USBSitePreview.prototype,$ush.mixinEvents,{_clearCookies:function(){$ush.removeCookie(_COOKIE_NAME_FOR_PREVIEW_OPTIONS_)},debounce_fn_30ms:$ush.debounce($ush.fn,30),_onPreviewChange:function(instructions,value,fieldType,data){var self=this,isUndefined=$ush.isUndefined,isPlainObject=$.isPlainObject;var _data={changed:'',liveOptions:'',};if(isPlainObject(data)){$.extend(!0,_data,data)}
if(!$usb.siteSettings.isChanged()){self.trigger('clearCookies')}
else if(typeof _data.changed==='string'){$ush.setCookie(_COOKIE_NAME_FOR_PREVIEW_OPTIONS_,_data.changed,15)}
if(instructions===!0){self.debounce_fn_30ms($usb.reloadPreview.bind($usb));return}
if(isUndefined(instructions[0])){instructions=[instructions||{}]}
for(var i in instructions){var instruction=instructions[i];if(isUndefined(instruction.elm)){continue}
var $elm=$(instruction.elm);if(!$elm.length){continue}
if(!isUndefined(instruction.mod)){var mod=''+instruction.mod,pcre=new RegExp('((^|\\s)'+$ush.escapePcre(mod)+'[a-zA-Z0-9\_\-]+)','g');$elm.each(function(_,elm){elm.className=elm.className.replace(pcre,'')});value=$.isArray(value)?value:(''+value).split(',');$.each(value||[],function(_,value){if(value){$elm.addClass(mod+'_'+value)}})}
if(!isUndefined(instruction.css)){if(fieldType==='upload'&&$.isNumeric(value)&&instruction.css.indexOf('background')===0){value='url(%s)'.replace('%s',$usb.getAttachmentUrl(value))}
$elm.css(instruction.css,value)}
if(!isUndefined(instruction.typography)){$ush.debounce_fn_1ms(function(){var liveOptions=$ush.toPlainObject(_data.liveOptions);if($.isEmptyObject(liveOptions)){return}
var collections={};$.each($usb.config('typography.tags',[]),function(_,tagName){var options=liveOptions[tagName];if(isUndefined(options)){return}
$.each($usb.config('breakpoints',{}),function(screen,_){if(!isPlainObject(collections[screen])){collections[screen]={':root':{}}}
$.each(options,function(key,value){key=(tagName=='body')?'--'+key:'--'+tagName+'-'+key;var maybeResponsiveValue=$ush.toPlainObject(value);if(!$ush.isUndefined(maybeResponsiveValue.default)){value=(!$ush.isUndefined(maybeResponsiveValue[screen]))?maybeResponsiveValue[screen]:maybeResponsiveValue.default}
collections[screen][':root'][key]=value})})});$usb.fonts.setGoogleFonts(liveOptions);$elm.text($usb.cssGenerator(collections))})}}}});_window.$usbp=new USBSitePreview}(jQuery)