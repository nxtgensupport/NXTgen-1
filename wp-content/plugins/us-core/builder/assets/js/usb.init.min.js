!function($,undefined){var _document=document,_location=location,_undefined=undefined,_window=window;['$ush','$usbdata'].map(function(name){_window[name]=_window[name]||{}});_window._NOTIFY_TYPE_={ERROR:'error',INFO:'info',SUCCESS:'success'};_window._CHANGED_ACTION_={CALLBACK:'callback',CREATE:'create',MOVE:'move',REMOVE:'remove',UPDATE:'update'};var _$temp={xhr:{}};var _$config={actions:{site_settings:'us-site-settings',},};function USBInit(container){var self=this;self.iframe;self.iframeIsReady=!1;self._hotkeyStates={};_window.onmessage=self._onMessage.bind(self);self._events={iframeReady:self._iframeReady.bind(self),urlManager:self._urlManager.bind(self),keydown:self._keydown.bind(self),};$(function(){self.$document=$(_document);self.$body=$('body');self.$container=$(container);self.$panel=$('#usb-panel');self.$panelBody=$('.usb-panel-body',self.$panel);self.$iframe=$('iframe',self.$container);self.iframe=self.$iframe[0];if(self.$container.is('[onclick]')){$usb.setConfig($.extend(_$config,self.$container[0].onclick()||{}));self.$container.removeAttr('onclick')}
if(self.$iframe.is('[data-src]')){self.$iframe.attr('src',self.$iframe.data('src')).removeAttr('data-src')}
self.$iframe.on('load',$ush.debounce(self._events.iframeReady,1));self.$document.on('keydown',self._events.keydown);$('html').attr('data-useragent',$ush.ua);if($ush.isMacOS){$('[data-macos-shortcuts]',self.$container).each(function(_,node){var $node=$(node);$node.text($node.data('macos-shortcuts')||'')})}
self._urlManager(self.urlManager.getDataOfChange())});self.on('urlManager.changed',self._events.urlManager)}
var prototype=USBInit.prototype;$.extend(prototype,$ush.mixinEvents,{_urlManager:function(state){var self=this,iframeSrc=self.iframe.src,action=state.setParams.action;if($usbcore.indexOf(action,self.config('actions',[]))===-1){action=self.config('actions.site_settings')}
self.$body.usMod('action',action||!1)},_onMessage:function(e){var data,self=this;try{data=JSON.parse(e.data)}catch(err){return}
if(data instanceof Array&&data[0]==='usb'&&data[1]!==_undefined){self.trigger(data[1],data[2]||[])}},_iframeReady:function(){var self=this;self.iframeIsReady=!0;if(!self.iframe.contentDocument){return}
self.preview.hidePreloader();self.trigger('iframeReady')},_keydown:function(e){if(e.type!=='keydown'){return}
var self=this,isCmd=(e.metaKey||e.ctrlKey),isUndo=(isCmd&&!e.shiftKey&&e.which===90),isRedo=(isCmd&&e.shiftKey&&e.which===90),isSave=(isCmd&&!e.shiftKey&&e.which===83);if($.isPlainObject(self._hotkeyStates)){$.extend(self._hotkeyStates,{'ctrl+z':isUndo,'ctrl+shift+z':isRedo,'ctrl+s':isSave});for(var combination in self._hotkeyStates){if(self._hotkeyStates[combination]===!0){self.trigger('hotkeys.'+combination)}}}
if(isSave||((isUndo||isRedo)&&$.inArray($ush.toLowerCase(e.target.tagName||''),['input','textarea'])>-1)){e.preventDefault()}},});$.extend(prototype,{postMessage:function(eventType,extraParams){var self=this;if(!self.iframeIsReady){return}
self.iframe.contentWindow.postMessage(JSON.stringify(['usb',eventType,extraParams]))},triggerDocument:function(eventType,extraParams){this.$document.trigger('usb.'+eventType,extraParams)}});$.extend(prototype,{find:function(path,defaultValue){return path&&$usbcore.deepFind(this,path,defaultValue||_undefined)},reloadPreview:function(){var self=this;if(!self.iframeIsReady){return}
self.preview.showPreloader();self.iframe.contentWindow.location.reload()},setConfig:function(config){if($.isPlainObject(config)){_$config=$.extend(!0,_$config,config);$usbcore.cache('config').flush()}},config:function(path,defaultValue){if($ush.isUndefined(path)){return $ush.clone(_$config)}
return $usbcore.cache('config').get(path,function(){return $usbcore.deepFind(_$config,path,defaultValue)})},licenseIsActivated:function(){return!!this.config('license_is_activated',!1)},hotkeys:function(){var args=$ush.toArray(arguments);for(var i in args)if(this._hotkeyStates[''+args[i]]===!0){return!0}
return!1},log:function(){var args=$ush.toArray(arguments);if(!args.length){args=['log: called with no params']}
console.log.apply(null,args)},getTextTranslation:function(key){if(!key){return ''}
return(_window.$usbdata.textTranslations||{})[key]||key},_normalizeInstructions:function(instructions){if(!!instructions&&!$.isArray(instructions)&&instructions!==!0){instructions=$.isPlainObject(instructions)?[instructions]:[]}
return instructions},buildString:function(template,params){if(!$.isPlainObject(params)){params={}}
var self=this,pattern=$ush.escapePcre($usb.config('startSymbol','{%'));pattern+='([A-z\\_\\d]+)';pattern+=$ush.escapePcre($usb.config('endSymbol','%}'));return(''+template).replace(new RegExp(pattern,'gm'),function(_,varName){return ''+(params[varName]||'')})},getAttachment:function(id){if(!id||!wp.media){return}
return wp.media.attachment(id)},getAttachmentUrl:function(id){if(!id){return ''}
return(this.getAttachment(id)||{get:$.noop}).get('url')||''},ajax:function(requestId,settings){var self=this;if(!requestId||$.isEmptyObject(settings)){return}
settings=$ush.clone(settings,{data:{},abort:$.noop,complete:$.noop,error:$.noop,success:$.noop});if(!$ush.isUndefined(_$temp.xhr[requestId])){_$temp.xhr[requestId].abort();if($.isFunction(settings.abort)){settings.abort.call(self,requestId)}}
_$temp.xhr[requestId]=$.ajax({data:$.extend({},self.config('ajaxArgs',{}),settings.data),dataType:'json',type:'post',url:_window.ajaxurl,cache:!1,success:function(res){delete _$temp.xhr[requestId];if(!res.success){var message=($ush.isUndefined(res.data)?'Invalid `res.data`':res.data.message);self.notify.add('XHR: '+message,_NOTIFY_TYPE_.ERROR)}
if($.isFunction(settings.success)){settings.success.call(self,res)}},error:function(jqXHR,textStatus,errorThrown){if(textStatus==='abort'){return}
if($.isFunction(settings.error)){settings.error.call(self,requestId)}
if(!errorThrown){errorThrown='Request was not sent'}
self.log('XHR.error:'+errorThrown,jqXHR,requestId)},complete:function(_,textStatus){if(textStatus==='abort'){return}
if($.isFunction(settings.complete)){settings.complete.call(self,requestId,textStatus)}}})},redirect:function(url){var self=this;if(url&&typeof url==='string'){self.iframeIsReady=!1;_location.href=url}}});_window.$usb=new USBInit('#usb-wrapper')}(jQuery);!function($,undefined){var _window=window,_document=document,_undefined=undefined;['$ush'].map(function(name){_window[name]=_window[name]||{}});var _$$cache={};var Data=function(namespace){self=this;self._$data={};self._namespace=namespace};dataPrototype=Data.prototype;dataPrototype.isEmpty=function(){return $.isEmptyObject(this._$data)};dataPrototype.has=function(key){return!$ush.isUndefined(this._$data[key])};dataPrototype.get=function(key,value){var self=this;if(!self.has(key)){if($.isFunction(value)){value=value.call(self)}
if(arguments.length===2){self._$data[key]=value}}
return self._$data[key]};dataPrototype.set=function(){var self=this,values={},args=$ush.toArray(arguments);if(args.length==2&&typeof args[0]==='string'){values[args[0]]=args[1]}else if($.isPlainObject(args[0])){values=args[0]}
$.extend(self._$data,values);return self};dataPrototype.data=function(){return this._$data};dataPrototype.remove=function(key){var self=this,args=$ush.toArray(arguments);for(var i in args){if(self.has(args[i])){delete self._$data[args[i]]}}
return self};dataPrototype.flush=function(){var self=this;if(!$ush.isUndefined(_$$cache[self._namespace])){delete _$$cache[self._namespace]}};$usbcore={};$usbcore.comparePlainObject=function(){var args=arguments;for(var i=1;i>-1;i--){if(!$.isPlainObject(args[i])){return!1}}
return JSON.stringify(args[0])===JSON.stringify(args[1])};$usbcore.diffPlainObject=function(objectA,objectB){var self=this,result={};if(self.comparePlainObject(objectA,objectB)){return result}
for(var k in objectA){if($.isPlainObject(objectA[k])){var diff=self.diffPlainObject(objectA[k],$.isPlainObject(objectB[k])?objectB[k]:{});if(!$.isEmptyObject(diff)){result[k]=diff}}else if($ush.isUndefined(objectB[k])||objectA[k]!==objectB[k]){result[k]=objectA[k]}}
return $.isEmptyObject(result)?result:$ush.clone(result)};$usbcore.clearPlainObject=function(data,props){var self=this;if(!$.isPlainObject(data)){data={}}
if($ush.isUndefined(props)){return data}
if(!$.isArray(props)){props=[''+props]}
data=$ush.clone(data);for(var k in props){var prop=props[k];if(!data.hasOwnProperty(prop)){continue}
delete data[prop]}
return data}
$usbcore.indexOf=function(value,data){var self=this;if($.isPlainObject(data)){data=Object.values(data)}
if($.isArray(data)){return data.indexOf($.isNumeric(value)?value:''+value)}
return-1};$usbcore.deepFind=function(dataObject,path,defaultValue){var self=this;path=(''+path).replace(/[^A-z\d\-\_\.]/g,'').trim();if(!path){return defaultValue}
if(path.indexOf('.')>-1){path=path.split('.')}else{path=[path]}
var result=(typeof dataObject=='object')?dataObject:{};for(k in path){result=result[path[k]];if($ush.isUndefined(result)){return defaultValue}}
return result};$usbcore.$addClass=function(node,className){var self=this;if($ush.isNode(node)&&className){node.classList.add(className)}
return self};$usbcore.$removeClass=function(node,className){var self=this;if($ush.isNode(node)&&className){(''+className).split(/\s/).map(function(itemClassName){if(!itemClassName){return}
node.classList.remove(itemClassName)})}
return self};$usbcore.$toggleClass=function(node,className,state){var self=this;if($ush.isNode(node)&&className){self[!!state?'$addClass':'$removeClass'](node,className)}
return self};$usbcore.$hasClass=function(node,className){var self=this;if($ush.isNode(node)&&className){var classList=(''+className).split(/\s/);for(var i in classList){className=''+classList[i];if(!className){continue}
if(self.indexOf(className,(''+node.className).split(/\s/))>-1){return!0}}}
return!1};$usbcore.$attr=function(node,name,value){var self=this;if(!$ush.isNode(node)||!name){return}
if(!$ush.isUndefined(value)){node.setAttribute(name,value);return self}
else if(!!node.getAttribute){return node.getAttribute(name)||''}
return};$usbcore.$remove=function(node){var self=this;if($ush.isNode(node)){node.remove()}
return self};$usbcore.copyTextToClipboard=function(text){var self=this;try{var textarea=_document.createElement('textarea');textarea.value=''+text;self.$attr(textarea,'readonly','');self.$attr(textarea,'css','position:absolute;top:-9999px;left:-9999px');_document.body.append(textarea);textarea.select();_document.execCommand('copy');if(_window.getSelection){_window.getSelection().removeAllRanges()}else if(_document.selection){_document.selection.empty()}
self.$remove(textarea);return!0}catch(err){return!1}};$usbcore.cache=function(namespace){var self=this;if(!$.isPlainObject(_$$cache)){_$$cache={}}
if($ush.isUndefined(_$$cache[namespace])){_$$cache[namespace]=new Data(namespace)}
if($ush.isUndefined(namespace)){console.log('Error: Namespace not set',[namespace])}
return _$$cache[namespace]};$usbcore.storage=function(namespace){if(namespace=$ush.toString(namespace)){namespace+='_'}
var _localStorage=_window.localStorage;return{set:function(key,value){_localStorage.setItem(namespace+key,value)},get:function(key){return _localStorage.getItem(namespace+key)},remove:function(key){_localStorage.removeItem(namespace+key)}}};_window.$usbcore=$usbcore}(jQuery);!function($,undefined){var _history=history,_location=location,_undefined=undefined,_window=window;if(!_window.$usb){return}['$ush','$usbcore'].map(function(name){_window[name]=_window[name]||{}});const _RESERVED_PARAMS_=['post'];var _$locationHref=_location.href;var _$url=new URL(_$locationHref);function URLManager(){var self=this;_window.onpopstate=function(e){self.setUrl(_location);var state=$.isPlainObject(e.state)?$ush.clone(e.state):{};$.extend(state,self.getDataOfChange())
$usb.trigger('urlManager.changed',state);_$locationHref=_location.href}}
$.extend(URLManager.prototype,{setUrl:function(url){_$url=new URL(url);return this},getHref:function(){return _location.href},buildHref:function(){return _$url.toString()},hasChange:function(){var self=this;return self.getHref()!==self.buildHref()},hasParam:function(key,value){if(typeof key==='string'){var hasKey=_$url.searchParams.has(key);if(!value){return hasKey}
return hasKey&&_$url.searchParams.get(key)===value}
return!1},setParam:function(key,value){if(typeof key==='string'){if($ush.isUndefined(value)){_$url.searchParams.delete(key)}else{_$url.searchParams.set(key,value||'')}}
return this},setParams:function(params){var self=this;if($.isPlainObject(params)){for(var k in params){if(params[k]){self.setParam(k,params[k])}}}
return self},getParam:function(key){if(key&&this.hasParam(key)){return _$url.searchParams.get(key)}
return _undefined},getParams:function(keys){var self=this,result={};_$url.searchParams.forEach(function(value,key){if($.isArray(keys)&&keys.indexOf(key)===-1){return}
result[key]=value});return result},removeParam:function(key){var self=this;if(self.hasParam(key)){_$url.searchParams.delete(key)}
return self},removeParams:function(keys){var self=this;if($.isArray(keys)){keys.map(self.removeParam.bind(self))}
return self},getDataOfChange:function(){var self=this,data={setParams:{},oldParams:{}};(new URL(_$locationHref)).searchParams.forEach(function(value,key){if($usbcore.indexOf(key,_RESERVED_PARAMS_)===-1&&!self.hasParam(key,value)){data.oldParams[key]=value}});_$url.searchParams.forEach(function(value,key){if($usbcore.indexOf(key,_RESERVED_PARAMS_)===-1||(!$ush.isUndefined(data.oldParams[key])&&data.oldParams[key]!==value)){data.setParams[key]=value}});return data},push:function(state){var self=this;if(!self.hasChange()){return}
state=$.isPlainObject(state)?$ush.clone(state):{};$.extend(state,self.getDataOfChange());_history.pushState(state,'',self.buildHref());$usb.trigger('urlManager.changed',state);_$locationHref=_location.href}});$usb.urlManager=new URLManager}(jQuery);!function($,undefined){var _window=window;if(!_window.$usb){return}['$ush','$usbcore'].map(function(name){_window[name]=_window[name]||{}});function Notify(container){var self=this;self._events={close:self._close.bind(self)};$(function(){self.$container=$(container);$usb.$document.on('click','.usb_action_notification_close',self._events.close)})}
$.extend(Notify.prototype,{isReady:function(){return!$ush.isUndefined(this.$container)},add:function(message,type){var self=this,delayAutoClose=4000,$notification=self.$container.clone().removeClass('hidden');if(!!type&&$usbcore.indexOf(type,_NOTIFY_TYPE_)>-1){$notification.addClass('type_'+type)}
if(type!==_NOTIFY_TYPE_.ERROR){$notification.addClass('auto_close').data('handle',$ush.timeout(function(){$notification.find('.usb_action_notification_close').trigger('click')},delayAutoClose))}
$notification.find('span').html(''+message);$usb.$panel.append($notification)},_close:function(e){var $notification=$(e.target).closest('.usb-notification'),handle=$notification.data('handle');if(!!handle){$ush.clearTimeout(handle)}
$notification.fadeOut('fast',function(){$notification.remove()})},closeAll:function(){$('.usb-notification',$usb.$body).fadeOut('fast',function(){$(this).remove()})}});$usb.notify=new Notify('.usb-notification')}(jQuery);!function($,undefined){var _window=window,_document=document;if(!_window.$usb){return}['$ush','$usbcore'].map(function(name){_window[name]=_window[name]||{}});function Panel(container){var self=this;self._events={switch:self._switch.bind(self),urlManager:self._urlManager.bind(self),};$(function(){self.$container=$(container);self.$header=$('.usb-panel-header',self.$container);self.$title=$('.usb-panel-header-title',self.$header);self.$body=$('.usb-panel-body',self.$container);self.$messages=$('.usb-panel-messages',self.$container);self.$actionSaveChanges=$('.usb_action_save_changes',self.$container);self.$container.on('click','.usb-panel-switcher',self._events.switch).on('click','.usb_action_save_changes',function(){$usb.trigger('panel.saveChanges')})});$usb.on('urlManager.changed',self._events.urlManager)}
$.extend(Panel.prototype,{isReady:function(){return!$ush.isUndefined(this.$container)},isShow:function(){return!$usb.$body.hasClass('hide_sidebars')},clearBody:function(){var self=this;self.hideMessage();$usb.trigger('panel.clearBody')},resetBodyScroll:function(){this.$body[0].scrollTo(0,0)},setTitle:function(title,isTranslationKey){var self=this;if(self.isReady()&&title){if(isTranslationKey){title=$usb.getTextTranslation(title)}
self.$title.html(typeof title==='string'?title:'no_title')}},showMessage:function(text){var self=this;self.clearBody();$usb.trigger('panel.showMessage',text);self.$messages.removeClass('hidden').html(text)},hideMessage:function(){var self=this;if(self.isReady()){self.$messages.addClass('hidden').html('')}},_switch:function(){var self=this;$usb.$body.toggleClass('hide_sidebars',self.isShow());$usb.trigger('panel.switch',self.isShow());$usb.postMessage('changeSwitchPanel')},showPreloader:function(){this.$container.addClass('show_preloader')},hidePreloader:function(){this.$container.removeClass('show_preloader')},switchSaveButton:function(enable,isLoading){this.$actionSaveChanges.prop('disabled',!enable).toggleClass('disabled',!enable).toggleClass('loading',isLoading===!0?enable:!1)},_urlManager:function(state){var self=this;if(!self.isReady()){return}
var _siteSettings=$usb.config('actions.site_settings');if(state.setParams.action===_siteSettings){$('.usb_action_show_add_elms',self.$header).addClass('hidden');$('.usb_action_go_to_back',self.$header).removeClass('hidden')}
else if(state.oldParams.action===_siteSettings){$('.usb_action_show_add_elms',self.$header).removeClass('hidden');$('.usb_action_go_to_back',self.$header).addClass('hidden')}}});$usb.panel=new Panel('#usb-panel')}(jQuery);!function($,undefined){var _window=window;var ceil=Math.ceil,max=Math.max;if(!_window.$usb){return}['$ush','$usbcore'].map(function(name){_window[name]=_window[name]||{}});const _DEFAULT_RESPONSIVE_SCREEN_='default';var _$temp={currentResponsiveScreen:'default',resizeControlWidth:20,};function Preview(container){var self=this;self._events={endResize:self._endResize.bind(self),hideToolbar:self._hideToolbar.bind(self),maybeResize:self._maybeResize.bind(self),maybeStartResize:self._maybeStartResize.bind(self),switchResponsiveScreen:self._switchResponsiveScreen.bind(self),switchToolbar:self._switchToolbar.bind(self),urlManager:self._urlManager.bind(self),};$(function(){self.$container=$(container);self.$screen=$('.usb-preview-screen',self.$container);self.$wrapper=$('.usb-preview-wrapper',self.$container);self.$inputWidth=$('input[name=screenWidth]',self.$container);self.$inputHeight=$('input[name=screenHeight]',self.$container);self.$actionSwitchToolbar=$('.usb_action_switch_toolbar',$usb.$panel);_$temp.resizeControlWidth=$ush.parseInt($('[data-resize-control]',self.$screen).width());self.$container.on('click','.usb_action_hide_toolbar',self._events.hideToolbar).on('click','[data-responsive-state]',self._events.switchResponsiveScreen);$usb.$document.on('mousedown','[data-resize-control]',self._events.maybeStartResize).on('mousemove',self._events.maybeResize).on('mouseup',self._events.endResize);$usb.$panel.on('click','.usb_action_switch_toolbar',self._events.switchToolbar);self._urlManager($usb.urlManager.getDataOfChange())});$usb.on('urlManager.changed',self._events.urlManager);self.on('document.syncResponsiveState',function(screenName){if(self.isScreenName(screenName)){$usb.triggerDocument('syncResponsiveState',screenName)}})}
var prototype=Preview.prototype;$.extend(prototype,$ush.mixinEvents,{isReady:function(){return!$ush.isUndefined(this.$container)},isShow:function(){return $usb.urlManager.hasParam('screen')},showPreloader:function(){this.$wrapper.addClass('show_preloader')},hidePreloader:function(){this.$wrapper.removeClass('show_preloader')},isScreenName:function(screen){return screen&&$usbcore.indexOf(screen,$usb.config('responsiveStates',[]))>-1},getCurrentOffset:function(){var rect=$ush.$rect($usb.iframe);return{y:rect.y||0,x:rect.x||0}},_urlManager:function(state){var self=this,currentScreen=state.setParams.screen;if(!self.isReady()||(currentScreen===_$temp.currentResponsiveScreen&&self.$container.hasClass('responsive_mode'))){return}
if(currentScreen){self.showToolbar(currentScreen)}
else if(state.oldParams.screen){self.hideToolbar()}},showToolbar:function(screen){var self=this;self.$container.addClass('responsive_mode');self.$actionSwitchToolbar.addClass('active');self.setResponsiveScreen(screen||_DEFAULT_RESPONSIVE_SCREEN_)},hideToolbar:function(){var self=this;self.$container.removeClass('responsive_mode');self.$actionSwitchToolbar.removeClass('active');self.setResponsiveScreen(_DEFAULT_RESPONSIVE_SCREEN_);self.$screen.removeAttr('style').removeData('_width');$usb.$iframe.removeAttr('style')},_hideToolbar:function(){$usb.urlManager.removeParam('screen').push()},_switchToolbar:function(){var self=this,urlManager=$usb.urlManager;if(!self.isShow()){urlManager.setParam('screen',_DEFAULT_RESPONSIVE_SCREEN_)}else{urlManager.removeParam('screen')}
urlManager.push()},_switchResponsiveScreen:function(e){var screen=$usbcore.$attr(e.target,'data-responsive-state');this.setResponsiveScreen(screen);$usb.urlManager.setParam('screen',screen).push()},_setScreenWidth:function(width){var self=this,resizeControlWidth=_$temp.resizeControlWidth*2,breakpoint=$usb.config('breakpoints.'+_$temp.currentResponsiveScreen,{}),maxWidth=$ush.parseInt(breakpoint.max_width)+resizeControlWidth,minWidth=max($ush.parseInt(breakpoint.min_width),$ush.parseInt($usb.config('preview.minHeight')))+resizeControlWidth;if(width>=maxWidth){width=maxWidth}
if(width<=minWidth){width=minWidth}
self.$inputWidth.val(width-resizeControlWidth);self.$screen.css('width',width)},setResponsiveScreen:function(screen){var self=this;if(!self.isScreenName(screen)){return}
self.$wrapper.usMod('responsive_state',screen);self.trigger('document.syncResponsiveState',screen);$('[data-responsive-state]',self.$container).removeClass('active').filter('[data-responsive-state="'+screen+'"]').addClass('active');_$temp.currentResponsiveScreen=screen;var resizeControlWidth=_$temp.resizeControlWidth;if(!self.$inputHeight.val()){self.$inputHeight.val($ush.parseInt(self.$screen.height())-resizeControlWidth||'')}
var containerWidth=$ush.parseInt(self.$container.width()),width=($usb.config('breakpoints.'+screen+'.breakpoint')||containerWidth)+(resizeControlWidth*2);if(width>=containerWidth){width=containerWidth}
self._setScreenWidth(width);self.$inputHeight.val(ceil($usb.$iframe.height()))},setFieldResponsiveScreen:$ush.debounce(function(){var self=this;if(self.isShow()){self.trigger('document.syncResponsiveState',_$temp.currentResponsiveScreen)}},100),fieldSetResponsiveScreen:function(screen){var self=this;if(!self.isShow()){self.showToolbar(screen)}else{self.setResponsiveScreen(screen)}
$usb.urlManager.setParam('screen',screen).push()},_maybeStartResize:function(e){var self=this;if(!self.isShow()){return}
var $screen=self.$screen;$usbcore.cache('temp').set('resizeData',{resizeControl:$usbcore.$attr(e.target,'data-resize-control'),startHeight:$ush.parseInt($screen.height()),startWidth:$ush.parseInt($screen.width()),startPageX:e.pageX,startPageY:e.pageY});$screen.addClass('resizable')},_maybeResize:function(e){var self=this;if(!self.isShow()){return}
var resizeData=$usbcore.cache('temp').data().resizeData;if($.isEmptyObject(resizeData||{})){return}
var resizeControlWidth=_$temp.resizeControlWidth,resizeControl=resizeData.resizeControl,isRightControl=resizeControl=='right';if(resizeControl=='left'||isRightControl){var pageX=e.pageX,offsetX=(resizeData.startPageX-pageX)*2,width=(isRightControl?resizeData.startWidth-offsetX:resizeData.startWidth+offsetX);var currentResponsiveScreen=_$temp.currentResponsiveScreen;if(currentResponsiveScreen==_DEFAULT_RESPONSIVE_SCREEN_){var maxWidth=$ush.parseInt($usb.config('breakpoints.'+currentResponsiveScreen+'.max_width')),windowWidth=(_window.innerWidth-1);if(maxWidth&&windowWidth<maxWidth&&(!pageX||pageX==windowWidth)){width=$ush.parseInt(self.$screen.width())+10;if(width>=maxWidth){resizeData.startWidth=maxWidth+resizeControlWidth;resizeData.startPageX=0}}}
self._setScreenWidth(width)}
if(resizeControl=='bottom'){var height=resizeData.startHeight-(resizeData.startPageY-e.pageY);var minHeight=$usb.config('preview.minHeight',320)+resizeControlWidth;if(height<minHeight){height=minHeight}
var wrapperHeight=$ush.parseInt(self.$wrapper.height());if(wrapperHeight&&height>wrapperHeight){height=wrapperHeight}
self.$inputHeight.val(height-resizeControlWidth);self.$screen.css('height',height)}},_endResize:function(){var self=this;if(!self.isShow()){return}
self.$screen.removeClass('resizable');$usbcore.cache('temp').remove('resizeData')}});$usb.preview=new Preview('#usb-preview')}(jQuery);!function($,undefined){var _window=window,isPlainObject=$.isPlainObject,isEmptyObject=$.isEmptyObject;if(!_window.$usb){return}['$ush'].map(function(name){_window[name]=_window[name]||{}});function CSSGenerator(collections){if(!isPlainObject(collections)){return ''}
var self=this,result='';for(var screen in collections){if(isEmptyObject(collections[screen])){continue}
var collection=collections[screen],styles='';for(var name in collection){if(!name||!isPlainObject(collection[name])){continue}
var props=collection[name];for(var prop_name in props){var prop_value=''+props[prop_name];if(!prop_name&&prop_value===''){continue}
if(prop_value.indexOf(' ')>-1&&prop_value.indexOf(',')==-1&&prop_name.indexOf('font-family')>-1){prop_value='"'+prop_value+'"'}
styles+=prop_name+':'+prop_value;if(prop_name.indexOf('--')!==0){styles+='!important'}
styles+=';'}
if(styles){if(name.indexOf(':')!==0){name='.'+name}
styles=name+'{'+styles+'}'}}
var breakpoint=$usb.config('breakpoints.'+screen+'.media','');if(screen!=='default'&&breakpoint){result+='@media '+breakpoint+'{'+styles+'}'}else{result+=styles}}
return result+''}
$usb.cssGenerator=CSSGenerator}(jQuery);!function($,undefined){var _window=window,isUndefined=$ush.isUndefined,isEmptyObject=$.isEmptyObject,isPlainObject=$.isPlainObject;if(!_window.$usb){return}['$ush'].map(function(name){_window[name]=_window[name]||{}});function Fonts(){}
$.extend(Fonts.prototype,{setGoogleFonts:function(themeOptions){if(!$usb.iframeIsReady){return}
var self=this,$node=$('link[id='+$usb.config('typography.fonts_id')+']',$usb.iframe.contentDocument);if($node.length){$node.attr('href',self._getGoogleEndpoint(themeOptions))}else{$('head',$usb.iframe.contentDocument).append('<link id="'+$usb.config('typography.fonts_id')+'" rel="stylesheet" href="'+self._getGoogleEndpoint(themeOptions)+'" media="all">')}},_getGoogleEndpoint:function(themeOptions){var self=this,usedFonts={},config=$usb.config('typography',{}),googleFonts=config.googleFonts||{};var tags=config.tags||[];for(var i in tags){var tag=tags[i],tagProps=themeOptions[tag];if(!isPlainObject(tagProps)){continue}
var fontFamily=tagProps['font-family'];if(isUndefined(fontFamily)){continue}
if(isUndefined(googleFonts[fontFamily])){continue}
var _fontFamily=$ush.rawurlencode(fontFamily);if(fontFamily!=='inherit'&&isUndefined(usedFonts[_fontFamily])){usedFonts[_fontFamily]=$ush.toString(googleFonts[fontFamily]).split(',')}}
var inlineFonts=[];for(var fontFamily in usedFonts){var font=fontFamily,weights=usedFonts[fontFamily];if(weights.length){font+=':'+weights.join(',')}
inlineFonts.push(font);}
if(inlineFonts.length){return config.googleapis+'?family='+inlineFonts.join('|')+'&display='+config.font_display}
return ''}});$usb.fonts=new Fonts}(jQuery);!function($,undefined){var _window=window,_document=document,_undefined=undefined;var abs=Math.abs,ceil=Math.ceil;['$ush','$usbdata'].map(function(name){_window[name]=_window[name]||{}});const _DIRECTION_={BOTTOM:'bottom',TOP:'top'};const _REGEXP_USBID_ALIAS_=/^([\w\-]+:\d+)\|([a-z\d\-]+)$/;var _$mode='preview';var _$defaultPageData={content:'',customCss:'',fields:{},pageMeta:{}};var _$temp={generatedIds:[],isInitDragDrop:!1,isProcessSave:!1,savedPageData:$ush.clone(_$defaultPageData),transit:null};var Builder=function(container){var self=this;self.mainContainer='container';self.selectedElmId;self._isReloadPreviewAfterSave=!1;self.pageData=$ush.clone(_$defaultPageData);_window.onbeforeunload=function(e){if(self.isPageChanged()){e.preventDefault();return $usb.getTextTranslation('page_leave_warning')}};self._events={dragstart:self._dragstart.bind(self),iframeReady:self._iframeReady.bind(self),maybeDrag:self._maybeDrag.bind(self),maybeStartDrag:self._maybeStartDrag.bind(self),modeChanged:self._modeChanged.bind(self),elmCopy:self._elmCopy.bind(self),elmPaste:self._elmPaste.bind(self),elmDelete:self._elmDelete.bind(self),elmDuplicate:self._elmDuplicate.bind(self),elmSelected:self._elmSelected.bind(self),endDrag:self._endDrag.bind(self),};$(function(){self.$container=$(container);$usb.$document.on('dragstart',self._events.dragstart)});$usb.on('iframeReady',self._events.iframeReady).on('builder.modeChanged',self._events.modeChanged).on('builder.endDrag',self._events.endDrag).on('builder.elmCopy',self._events.elmCopy).on('builder.elmPaste',self._events.elmPaste).on('builder.elmDelete',self._events.elmDelete).on('builder.elmDuplicate',self._events.elmDuplicate).on('builder.elmSelected',self._events.elmSelected)};var prototype=Builder.prototype;$.extend(prototype,$ush.mixinEvents,{_modeChanged:function(){$usb.postMessage('doAction','hideHighlight')},_iframeReady:function(){var self=this;if(!$usb.iframeIsReady){return}
var iframeWindow=$usb.iframe.contentWindow;if((iframeWindow.location.search||'').indexOf('&meta')!==-1){return}
$usb.postMessage('doAction','hideHighlight');self.pageData=$ush.clone((iframeWindow.$usbdata||{}).pageData||{},_$defaultPageData);_$temp.savedPageData=$ush.clone(self.pageData)},_elmSelected:function(id){var self=this;if(!self.isMode('editor')||!self.doesElmExist(id)){return}
$usb.navigator.setActive(id,!0);if(self.selectedElmId===id){return}
if(self.doesElmExist(id)){if($usb.find('panel')){self.one('panel.afterInitFieldset',function(){$usb.panel.resetBodyScroll()});$usb.builderPanel.initElmFieldset(id)}}else{$usb.postMessage('doAction','hideHighlight')}},_elmDuplicate:function(id){var self=this;if(!self.isValidId(id)){return}
var isUpdateIncludeParent=self.isUpdateIncludeParent(id),parentId=self.getElmParentId(id),strShortcode=self.getElmShortcode(id)||'',newId;strShortcode=strShortcode.replace(/(\s?el_id="([^\"]+)")/gi,'').replace(/usbid="([^\"]+)"/gi,function(_,elmId){elmId=self.getSpareElmId(elmId);if(!newId){newId=elmId}
return 'usbid="'+elmId+'"'});if(!strShortcode||!newId)return;var index=0,siblingsIds=self.getElmSiblingsId(id)||[];for(var i in siblingsIds){if(siblingsIds[i]===id){index=++i;break}}
if(!self._addShortcodeToContent(parentId,index,strShortcode)){return}
var position='after',isContainer=self.isElmContainer(id);$usb.postMessage('showPreloader',[id,position,isContainer,newId]);self._renderShortcode(newId,{data:{content:isUpdateIncludeParent?self.getElmShortcode(parentId):strShortcode},success:function(res){$usb.postMessage('hidePreloader',newId);if(!res.success){return}
var html=$ush.toString(res.data.html);html=html.replace(/(us_animate_this)/g,"$1 start");if(isUpdateIncludeParent){$usb.postMessage('updateSelectedElm',[parentId,html])}else{$usb.postMessage('insertElm',[id,position,html]);$usb.postMessage('maybeInitElmJS',newId)}
$usb.history.commitChange(newId,_CHANGED_ACTION_.CREATE);$usb.trigger('builder.contentChange')},abort:function(abortId){$usb.postMessage('hidePreloader',abortId)}})},_elmCopy:function(id){var self=this;if(!self.isValidId(id)){return}
var content=$ush.toString(self.getElmShortcode(id));$usbcore.copyTextToClipboard(content.replace(/\susbid="([^\"]+)"/gi,''));$usbcore.storage('usb').set('сlipboard',content)},_elmPaste:function(id){var self=this;if(!self.isValidId(id)){return}
var content=$ush.toString($usbcore.storage('usb').get('сlipboard'));if(!content){$usb.notify.add($usb.getTextTranslation('empty_clipboard'),_NOTIFY_TYPE_.INFO);return}
var newElmId;content=content.replace(/(\s?el_id="([^\"]+)")/gi,'').replace(/usbid="([^\"]+)"/gi,function(_,elmId){elmId=self.getSpareElmId(elmId);if(!newElmId){newElmId=elmId}
return 'usbid="'+elmId+'"'});var strictMode=(self.isElmTTA(id)||self.isChildElmContainer(id));var parentId=id
if((self.isRow(newElmId)&&self.isRow(id))||(self.isRowInner(newElmId)&&self.isRowInner(id))||(self.isElmSection(newElmId)&&self.isElmSection(id))){parentId=self.getElmParentId(id)}
if(!self.canBeChildOf(newElmId,parentId,strictMode)&&!(self.isElmSection(newElmId)&&self.isElmTTA(parentId))){$usb.notify.add($usb.getTextTranslation('cannot_paste'),_NOTIFY_TYPE_.INFO);return}
var index=0;if(parentId!==id){index=$ush.parseInt(self.getElmIndex(id))+1}else if(self.isElmTTA(parentId)){index=self.getElmChildren(parentId).length+1}
if(!self._addShortcodeToContent(parentId,index,content)){$usb.notify.add($usb.getTextTranslation('invalid_data'),_NOTIFY_TYPE_.ERROR);return}
var position;if(index===0){position='prepend'}else{position='after'}
$usb.postMessage('showPreloader',[id,position,self.isElmContainer(id),newElmId]);var isUpdateIncludeParent=self.isUpdateIncludeParent(newElmId);$usb.builder._renderShortcode(newElmId,{data:{isReturnContent:!0,content:isUpdateIncludeParent?self.getElmShortcode(parentId):content},success:function(res){$usb.postMessage('hidePreloader',newElmId);if(!res.success||!res.data.html){return}
var html=$ush.toString(res.data.html).replace(/(us_animate_this)/g,"$1 start");if(isUpdateIncludeParent){$usb.postMessage('updateSelectedElm',[parentId,html]);$usb.history.commitChange(parentId,_CHANGED_ACTION_.UPDATE)}else{$usb.postMessage('insertElm',[id,position,html]);$usb.postMessage('maybeInitElmJS',newElmId);$usb.history.commitChange(newElmId,_CHANGED_ACTION_.CREATE)}
$usb.trigger('builder.contentChange')},abort:function(abortId){$usb.postMessage('hidePreloader',abortId)}})},_elmDelete:function(removeId){var self=this;if(!self.isValidId(removeId)){return}
if(self.isChildElmContainer(removeId)&&self.getElmSiblingsId(removeId).length===1){removeId=self.getElmParentId(removeId)}
self.removeElm(removeId)}});$.extend(prototype,{_dragStartDistance:5,_dragstart:function(e){return!!$(e.target).closest('.media-frame').length},_initDragDrop:function(){var self=this;if(_$temp.isInitDragDrop){return}
_$temp.isInitDragDrop=!0;$usb.$document.on('mousedown',self._events.maybeStartDrag).on('mousemove',self._events.maybeDrag).on('mouseup',self._events.endDrag);$usbcore.cache('drag').set({startX:0,startY:0})},_destroyDragDrop:function(){var self=this;if(!_$temp.isInitDragDrop){return}
_$temp.isInitDragDrop=!1;$usb.$document.off('mousedown',self._events.maybeStartDrag).off('mousemove',self._events.maybeDrag).off('mouseup',self._events.endDrag);$usbcore.cache('drag').flush()},getNewElmId:function(){return $usbcore.cache('drag').get('newElmId','')},_getEventData:function(e){var self=this;if(!$usb.iframeIsReady){return}
var rect=$ush.$rect($usb.iframe),iframeWindow=$usb.iframe.contentWindow,data={clientX:e.clientX,clientY:e.clientY,eventX:e.pageX-rect.x,eventY:e.pageY-rect.y,pageX:(e.pageX+iframeWindow.scrollX)-rect.x,pageY:(e.pageY+iframeWindow.scrollY)-rect.y,};for(var prop in data){var value=data[prop]||NaN;if(isNaN(value)||value<0){data[prop]=0}else{data[prop]=ceil(data[prop])}}
return data},isParentDragging:function(){return!!_$temp.isParentDragging},showTransit:function(type){var self=this;if(!type){return}
if(self.hasTransit()){self.hideTransit()}
if(self.isValidId(type)){type=self.getElmType(type)}
var target=_document.querySelector('[data-type="'+type+'"]');var isTemplate=$usb.templates.isTemplate(type);if(isTemplate){target=$usb.templates.showTransit()}
if(!$ush.isNode(target)){return}
var transit={rect:$ush.$rect(target),scrollAcceleration:0,scrollDirection:_undefined,target:target.cloneNode(!0)};$usbcore.$removeClass(transit.target,'hidden');if(isTemplate){$usb.templates.hideTransit()}['width','height'].map(function(prop){var value=ceil(transit.rect[prop]);transit.target.style[prop]=value?value+'px':'auto'});$usbcore.$addClass(transit.target,'elm_transit').$addClass(transit.target,!self.isMode('drag:add')?'state_drag_move':'');_document.body.append(transit.target);_$temp.transit=transit},hasTransit:function(){return!!_$temp.transit},hasDragScrolling:function(){return $usbcore.indexOf((_$temp.transit||{}).scrollDirection,[_DIRECTION_.TOP,_DIRECTION_.BOTTOM])>-1},setTransitPosition:function(pageX,pageY){var self=this;if(!self.hasTransit()||!self.isMode('drag:add','drag:move')){return}
var transit=_$temp.transit||{};if(!$ush.isNode(transit.target)){return}
var isDragAdd=self.isMode('drag:add'),transitHeight=transit.rect.height,transitTop=$ush.parseInt(isDragAdd?pageY-(transitHeight/2):pageY),transitLeft=$ush.parseInt(isDragAdd?pageX-(transit.rect.width/2):pageX);transit.target.style.top=transitTop.toFixed(3)+'px';transit.target.style.left=transitLeft.toFixed(3)+'px';if(!$usb.iframeIsReady){return}
var remainderToEnd=0,scrollDirection,viewportBottom=$ush.parseInt(_window.innerHeight-transitHeight);if(pageY<transitHeight){remainderToEnd=abs(pageY-transitHeight);scrollDirection=_DIRECTION_.TOP}else if(pageY>viewportBottom){remainderToEnd=abs(pageY-viewportBottom);scrollDirection=_DIRECTION_.BOTTOM}
var scrollAcceleration=ceil(abs(remainderToEnd/ /*acceleration step in px*/30));if(scrollDirection!==transit.scrollDirection||scrollAcceleration!==transit.scrollAcceleration){transit.scrollDirection=scrollDirection;transit.scrollAcceleration=scrollAcceleration;$usb.postMessage('doAction',['_scrollDragging',[scrollDirection,scrollAcceleration]])}},hideTransit:function(){var self=this,transit=_$temp.transit||{};if(!self.hasTransit()||!$ush.isNode(transit.target)){return}
self.stopDragScrolling();$usbcore.$remove(transit.target);delete _$temp.transit},_maybeStartDrag:function(e){var self=this;if(!$usb.iframeIsReady||!e.target){return}
var found,iteration=0,target=e.target;while(!(found=!!$usbcore.$attr(target,'data-type'))&&iteration++<100){if(!target.parentNode){found=!1;break}
target=target.parentNode}
if(found){$usbcore.cache('drag').set({startDrag:!0,startX:e.pageX||0,startY:e.pageY||0,target:target,})}},_maybeDrag:function(e){var self=this,dragData=$usbcore.cache('drag').data();if(!dragData.startDrag||!dragData.target){return}
var diffX=abs(dragData.startX-e.pageX),diffY=abs(dragData.startY-e.pageY);if(diffX>self._dragStartDistance||diffY>self._dragStartDistance){if(self.isMode('editor')){$usbcore.cache('dragProcessData').flush();_$temp.isParentDragging=!0;self.setMode('drag:add');var tempTargetType=$usbcore.$attr(dragData.target,'data-type');dragData.newElmId=self.getSpareElmId(tempTargetType);self.showTransit(tempTargetType,e.pageX,e.pageY);$usbcore.$addClass(dragData.target,'elm_add_shadow').$addClass(_document.body,'elm_add_draging')}
if($ush.isFirefox&&self.isParentDragging()){var eventData=self._getEventData(e);if(eventData.pageX){$usb.postMessage('onParentEventData',['_maybeDrop',eventData])}}
self.setTransitPosition(e.pageX,e.pageY)}},_endDrag:function(e){var self=this;if(!$usb.iframeIsReady){return}
var dragData=$usbcore.cache('drag').data();if($ush.isNode(dragData.target)){$usbcore.$removeClass(dragData.target,'elm_add_shadow').$removeClass(_document.body,'elm_add_draging')}
if($usb.panel.isShow()&&$ush.isFirefox&&$usb.preview.getCurrentOffset().x>=e.clientX){self._clearDragAssets();return}
if(!self.isParentDragging()){$usbcore.cache('drag').flush();return}
if(!!dragData.parentId&&!!dragData.currentId){var currentIndex=$ush.parseInt(dragData.currentIndex);if(self.isAliasElmId(dragData.parentId)){dragData.parentId=self.removeAliasFromId(dragData.parentId)}
var templateId=$usbcore.$attr(dragData.target,'data-template-id');if(templateId){var templateCategoryId=$(dragData.target).closest('.usb-template').data('template-category-id');$usb.templates.insertTemplate(templateCategoryId,templateId,dragData.parentId,currentIndex)}
else{self.createElm(self.getElmType(dragData.currentId),dragData.parentId,currentIndex)}
if(self.isElmSection(dragData.parentId)){$usb.postMessage('doAction',['openSectionById',dragData.parentId])}}
if($ush.isFirefox){$usb.postMessage('onParentEventData','_endDrag')}
self._clearDragAssets()},_clearDragAssets:function(){var self=this;self.hideTransit();_$temp.isParentDragging=!1;$usbcore.cache('drag').flush();self.setMode('editor');$usb.postMessage('doAction','clearDragAssets')},removeDragScrollData:function(){delete(_$temp.transit||{}).scrollDirection},stopDragScrolling:function(){var self=this,transit=_$temp.transit||{};if(!self.hasDragScrolling()){return}
self.removeDragScrollData();$usb.postMessage('doAction','_scrollDragging')}});$.extend(prototype,{isProcessSave:function(){return _$temp.isProcessSave},savePageData:function(complete){var self=this;var data={pageMeta:{},};if(self.isContentChanged()){data.post_content=self.pageData.content}
if(self.isPageFieldsChanged()){for(var prop in self.pageData.fields){data[prop]=self.pageData.fields[prop]}}
if(self.isPageMetaChanged()){for(var prop in self.pageData.pageMeta){data.pageMeta[prop]=self.pageData.pageMeta[prop]}}
if(self.isPageCustomCssChanged()){data.pageMeta[$usb.config('keyCustomCss','')]=self.pageData.customCss}
_$temp.isProcessSave=!0;$usb.ajax('_savePageData',{data:$.extend(data,{_nonce:$usb.config('_nonce'),action:$usb.config('action_save_post'),}),success:function(res){if(!res.success){return}
$usb.notify.add($usb.getTextTranslation('page_updated'),_NOTIFY_TYPE_.SUCCESS);if(self._isReloadPreviewAfterSave&&self.isPageMetaChanged()){self._isReloadPreviewAfterSave=!1;$usb.reloadPreview()}
_$temp.savedPageData=$ush.clone(self.pageData)},complete:function(){if($.isFunction(complete)){complete()}
_$temp.isProcessSave=!1}})},isContentChanged:function(){return(_$temp.savedPageData.content||'')!==(this.pageData.content||'')},isPageCustomCssChanged:function(){return(_$temp.savedPageData.customCss||'')!==(this.pageData.customCss||'')},isPageFieldsChanged:function(){return!$usbcore.comparePlainObject(_$temp.savedPageData.fields,this.pageData.fields)},isPageMetaChanged:function(){return!$usbcore.comparePlainObject(_$temp.savedPageData.pageMeta,this.pageData.pageMeta)},isPageChanged:function(){var self=this;return(self.isContentChanged()||self.isPageMetaChanged()||self.isPageFieldsChanged()||self.isPageCustomCssChanged())},saveTempContent:function(){_$temp.tempContent=''+this.pageData.content},restoreTempContent:function(){var self=this;if(!self.isEmptyTempContent()){self.pageData.content=(''+_$temp.tempContent)||self.pageData.content;delete _$temp.tempContent;return!0}
return!1},isEmptyTempContent:function(){return $ush.isUndefined(_$temp.tempContent)},isEmptyContent:function(){return(''+this.pageData.content).indexOf('[vc_row')===-1},isResponsiveObject:function(value){if(!$.isPlainObject(value)){return!1}
var states=$usb.config('responsiveStates',[]);for(var i in states)if(value.hasOwnProperty(states[i])){return!0}
return!1},isValidMode:function(mode){var _availableModes=['unknown','editor','preview','drag:add','drag:move',];return mode&&$usbcore.indexOf(mode,_availableModes)>-1},isMode:function(){var self=this,args=arguments;for(var i in args){if(self.isValidMode(args[i])&&_$mode===args[i])return!0}
return!1},setMode:function(mode){var self=this;if(mode&&self.isValidMode(mode)&&mode!==_$mode){$usb.trigger('builder.modeChanged',_$mode=mode);return!0}
return!1},getShortcodePattern:function(tag){return new RegExp('\\[(\\[?)('+tag+')(?![\\w-])([^\\]\\/]*(?:\\/(?!\\])[^\\]\\/]*)*?)(?:(\\/)\\]|\\](?:([^\\[]*(?:\\[(?!\\/\\2\\])[^\\[]*)*)(\\[\\/\\2\\]))?)(\\]?)','g')},removeHtmlWrap:function(content){return $ush.toString(content).replace(/^<[^\[]+|[^\]]+$/gi,'')},parseShortcode:function(shortcode){var self=this;if(!shortcode){return{}}
shortcode=self.removeHtmlWrap(shortcode);var firstTag=(shortcode.match(/^.*?\[([\w\-]+)\s/)||[])[1]||'',result=(self.getShortcodePattern(firstTag)).exec(shortcode);if(result){return{tag:result[2],atts:self._unescapeAttr(result[3]||''),input:result[0],content:result[5]||'',hasClosingTag:!!result[6]}}
return{}},parseAtts:function(str){var result={};if(!str){return result}
str=str.replace(/[\u00a0\u200b]/g,' ');(str.match(/[\w-_]+="([^\"]+)?"/g)||[]).forEach(function(attribute){attribute=attribute.match(/([\w-_]+)="([^\"]+)?"/);if(!attribute){return}
var value=$ush.toString(attribute[2]).replace(/``/g,'"').replace(/`{`/g,'[').replace(/`}`/g,']');result[attribute[1]]=value.trim()});return result},buildShortcode:function(shortcode,attsDefaults){if($.isEmptyObject(shortcode)){return ''}
var self=this,result='['+shortcode.tag;if(shortcode.atts||attsDefaults){if(!$.isEmptyObject(attsDefaults)){shortcode.atts=self.buildAtts(self.parseAtts(shortcode.atts),attsDefaults)}
shortcode.atts=self._escapeAttr(shortcode.atts);result+=' '+shortcode.atts.trim()}
result+=']';if(shortcode.content){result+=shortcode.content}
if(shortcode.hasClosingTag){result+='[/'+shortcode.tag+']'}
return ''+result},buildAtts:function(atts,defaults){if(!atts||$.isEmptyObject(atts)){return ''}
if($.isEmptyObject(defaults)){defaults={}}
var result=[];for(var k in atts){var value=atts[k];if(value===null||$ush.isUndefined(value)||(!$ush.isUndefined(defaults[k])&&defaults[k]===value)){continue}
if($.isPlainObject(value)){var inlineValue=[];for(var i in value){if(value[i]){inlineValue.push(i+':'+value[i])}}
value=inlineValue.join('|')}
value=$ush.toString(value).replace(/\"/g,'``').replace(/\[/g,'`{`').replace(/\]/g,'`}`');result.push(k+'="'+value+'"')}
return result.join(' ')},isValidId:function(id){return id&&/^([\w\-]+):(\d+)(\|[a-z\-]+)?$/.test(id)},isRow:function(id){return this.getElmName(id)==='vc_row'},isRowInner:function(id){return this.getElmName(id)==='vc_row_inner'},isColumn:function(id){return/^vc_column(_inner)?$/.test(this.getElmName(id))},isOutsideMainContainer:function(id){var self=this;return $usbcore.indexOf(self.getElmName(id),$usb.config('elms_outside_main_container',[]))>-1},isMainContainer:function(id){return id&&id===this.mainContainer},isElmContainer:function(name){var self=this;name=self.isValidId(name)?self.getElmName(name):name;return name&&$usb.config('shortcode.containers',[]).indexOf(name)>-1},isRootElmContainer:function(name){var self=this;name=self.isValidId(name)?self.getElmName(name):name;return(self.isElmContainer(name)&&!!$usb.config('shortcode.relations.as_parent.'+name+'.only'))},isChildElmContainer:function(name){var self=this;name=self.isValidId(name)?self.getElmName(name):name;return(self.isElmContainer(name)&&!self.isRootElmContainer(name)&&!!$usb.config('shortcode.relations.as_child.'+name+'.only'))},isUpdateIncludeParent:function(id){var self=this;if($ush.isNode(id)){id=self.getElmId(id)}
if(!self.isValidId(id)){return!1}
var name=self.getElmName(id);return name&&$usb.config('shortcode.update_parent',[]).indexOf(name)>-1},isElmTTA:function(name){var self=this;if(self.isValidId(name)){name=self.getElmType(name)}
return/^vc_tta_(tabs|tour|accordion)$/.test(name)},isElmTab:function(name){var self=this;if(self.isValidId(name)){name=self.getElmType(name)}
return/^vc_tta_(tabs|tour)$/.test(name)},isElmSection:function(name){var self=this;if(self.isValidId(name)){name=self.getElmType(name)}
return name==='vc_tta_section'},_escapeAttr:function(value){return $ush.toString(value).replace(/\[/g,'&#91;').replace(/\]/g,'&#93;')},_unescapeAttr:function(value){return $ush.toString(value).replace(/&#91;/g,'[').replace(/&#93;/g,']')},canBeChildOf:function(id,parent,strict){var self=this,args=arguments,isMainContainer=self.isMainContainer(parent);if(self.isMainContainer(id)||!self.isValidId(id)||!(self.isValidId(parent)||isMainContainer)){return!1}
var targetName=self.getElmName(id),parentName=isMainContainer?parent:self.getElmName(parent),shortcodeRelations=$.extend({},$usb.config('shortcode.relations',{})),result=!0;if($.isEmptyObject(shortcodeRelations)){$usb.log('Notice: There are no relations and movement is allowed for every one',args);return!0}
return self._cacheDragProcessData(function(){for(var name in shortcodeRelations){if(!result){break}
var relations=shortcodeRelations[name][name==='as_child'?targetName:parentName];if(!$ush.isUndefined(relations)){for(var condition in relations){if(self.isMode('drag:add')&&parentName===self.mainContainer&&!self.isChildElmContainer(id)){continue}
if(!result){break}
var allowed=(relations[condition]||'').split(','),isFound=allowed.indexOf(name==='as_child'?parentName:targetName)!==-1;if((condition==='only'&&!isFound)||(condition==='except'&&isFound)){result=!1}}}}
if(result&&!!strict&&(isMainContainer||self.isChildElmContainer(id))){var isTempContent=(self.isMode('drag:move')&&!self.isEmptyTempContent()),tempContent;if(isTempContent){tempContent=self.pageData.content;self.restoreTempContent()}
var elmParentId=self.getElmParentId(id);if(isTempContent&&tempContent){self.saveTempContent();self.pageData.content=''+tempContent}
return parent===elmParentId}
return result},'canBeChildOf:'+$ush.toArray(args).join('|'),!1)},hasSameTypeParent:function(type,parent){var self=this;if(self.isMainContainer(type)||self.isMainContainer(parent)||!self.isValidId(parent)){return!1}
type=self.isValidId(type)?self.getElmType(type):type;if(type===self.getElmType(parent)){return!0}
var iteration=0;while(parent!==null||self.isMainContainer(parent)){if(iteration++>=1000){break}
parent=self.getElmParentId(parent);if(self.getElmType(parent)===type){return!0}}
return!1},getValidContainerId:function(container){var self=this;return!self.isElmContainer(container)?self.mainContainer:container},isAliasElmId:function(id){var self=this;if(!self.isValidId(id)){return!1}
return _REGEXP_USBID_ALIAS_.test(id)},getAliasFromId:function(id){var self=this;if(!self.isValidId(id)){return null}
return(id.match(_REGEXP_USBID_ALIAS_)||[])[2]||null},addAliasToElmId:function(alias,id){var self=this,args=arguments;if(alias&&typeof alias==='string'&&self.isValidId(id)){id+='|'+alias}else{$usb.log('Notice: Failed to add alias to id',args)}
return id},removeAliasFromId:function(id){var self=this;if(!self.isValidId(id)){return id}
return(id.match(_REGEXP_USBID_ALIAS_)||[])[1]||id},getElmType:function(id){var self=this;if($ush.isNode(id)){id=self.getElmId(id)}
return self.isValidId(id)?id.split(':')[0]||'':''},getElmName:function(id){var self=this;return self._cacheDragProcessData(function(){var type=self.getElmType(id);return(type.match(/us_(.*)/)||[])[1]||type},'getElmName:'+id,'')},getElmTitle:function(id){var self=this;if(!self.isValidId(id)){return 'Unknown'}
var name=self.getElmName(id);return $usb.config('elm_titles.'+name)||name},doesElmExist:function(id){var self=this;if(!self.isValidId(id)||!self.pageData.content){return!1}
return self._cacheDragProcessData(function(){return(new RegExp('\\['+self.getElmType(id)+'[^\\]]+usbid=\\"'+$ush.escapePcre(id)+'\\"')).test(''+self.pageData.content)},'doesElmExist:'+id,!1)},getElmId:function(node){if(!$ush.isNode(node)){return ''}
if(!node.hasOwnProperty('_$$usbid')){var self=this,id=$usbcore.$attr(node,'data-usbid');node._$$usbid=(self.isValidId(id)||self.isMainContainer(id))?id:''}
return node._$$usbid},getElmIndex:function(id){var self=this;if(!self.isValidId(id)){return null}
var index=(self.getElmSiblingsId(id)||[]).indexOf(id);return index>-1?index:null},getSpareElmId:function(type){var self=this;if(!type){return ''}
if(self.isValidId(type)){type=self.getElmType(type)}
if(!_$temp.generatedIds){_$temp.generatedIds=[]}
for(var index=1;;index++){var id=type+':'+index;if(!self.doesElmExist(id)&&_$temp.generatedIds.indexOf(id)<0){_$temp.generatedIds.push(id);return id}}},getElmParentId:function(id){var self=this,parentId=self.mainContainer;if(id===parentId||!self.doesElmExist(id)){return null}
return self._cacheDragProcessData(function(){var result=parentId,content=(''+self.pageData.content),elmRegex=new RegExp('\\['+self.getElmType(id)+'[^\\]]+usbid=\\"'+$ush.escapePcre(id)+'\\"'),startPosition=content.search(elmRegex),prevContent=content.slice(0,startPosition),nextContent=content.slice(startPosition).replace(self.getShortcodePattern(self.getElmType(id)),''),closingTags=nextContent.match(/\[\/(\w+)/g)||[],parentTagMatch,parentTag,parentTagAtts;$.each(closingTags,function(index,closingTag){closingTag=closingTag.substr(2);parentTagMatch=prevContent.match(new RegExp('\\['+closingTag+'\\s([^\\]]+)(?!.*\\[\\/'+closingTag+'(\\s|\\]))','s'));if(parentTagMatch!==null){parentTagAtts=self.parseAtts(parentTagMatch[1]);parentTag=self.getElmShortcode(parentTagAtts.usbid);if(parentTag.search(elmRegex)>-1){result=parentTagAtts.usbid;return!1}}});return result},'getElmParentId:'+id,parentId)},getElmNextId:function(id){var self=this;if(!self.isValidId(id)||self.isMainContainer(id)){return null}
var children=self.getElmChildren(self.getElmParentId(id)),currentIndex=children.indexOf(id);if(currentIndex<0||children.length===currentIndex){return null}
return children[++currentIndex]||null},getElmPrevId:function(id){var self=this;if(!self.isValidId(id)||self.isMainContainer(id)){return null}
var children=self.getElmChildren(self.getElmParentId(id)),currentIndex=children.indexOf(id);if(currentIndex<0||currentIndex===0){return null}
return children[--currentIndex]||null},getElmSiblingsId:function(id){var self=this;if(!self.isValidId(id)||self.isMainContainer(id)){return[]}
return self.getElmChildren(self.getElmParentId(id))},getElmChildren:function(id){var self=this,isMainContainer=self.isMainContainer(id);if(!id||!(self.isValidId(id)||isMainContainer)){return[]}
return self._cacheDragProcessData(function(){var content=!isMainContainer?(self.parseShortcode(self.getElmShortcode(id))||{}).content||'':''+self.pageData.content;if(!content){return[]}
var i=0,result=[],firstShortcode;while(firstShortcode=self.parseShortcode(content)){if(i++>9999||$.isEmptyObject(firstShortcode)){break}
var usbid=self.parseAtts(firstShortcode.atts)['usbid']||null;if(usbid){result.push(usbid)}
content=content.replace(firstShortcode.input,'')}
return result},'getElmChildren:'+id,[])},getElmAllChildren:function(id){var self=this;if(!self.isValidId(id)||!self.isElmContainer(id)){return[]}
var results=[],args=arguments,childrenIDs=self.getElmChildren(id),recursionLevel=$ush.parseInt(args[1]);for(var i in childrenIDs){var childrenId=childrenIDs[i];if(!self.isValidId(childrenId)){continue}
results.push(childrenId);if(self.isElmContainer(childrenId)){if(recursionLevel>=20){$usb.log('Notice: Exceeded number of levels in recursion:',args)}else{results=results.concat(self.getElmAllChildren(childrenId,recursionLevel++))}}}
return results},getElmShortcode:function(id){var self=this,content=(''+self.pageData.content);if($ush.isUndefined(id)){return content}
if(!self.isValidId(id)){return ''}
var matches=content.match(self.getShortcodePattern(self.getElmType(id)));if(matches){for(var i in matches){if(matches[i].indexOf('usbid="'+id+'"')!==-1){return matches[i]}}}
return ''},getElmNode:function(id){var self=this;if(!$usb.iframeIsReady){return null}
return($usb.iframe.contentWindow.$usbp||{}).getElmNode(id)},getElmOuterHtml:function(id){var self=this;if(!$usb.iframeIsReady){return ''}
return($usb.iframe.contentWindow.$usbp||{}).getElmOuterHtml(id)||''},getElmValues:function(id){var self=this;if(!self.doesElmExist(id)){return{}}
var shortcode=self.parseShortcode(self.getElmShortcode(id));if(!$.isEmptyObject(shortcode)){var result=self.parseAtts(shortcode.atts),elmName=self.getElmName(id);var editContent=$usb.config('shortcode.edit_content',{});if(!!editContent[elmName]){result[editContent[elmName]]=''+shortcode.content}
return result}
return{}},getElmValue:function(id,key,defaultValue){return this.getElmValues(id)[key]||defaultValue},setElmValues:function(id,values){var self=this;if(!self.doesElmExist(id)||$.isEmptyObject(values)){return}
var shortcodeText=self.getElmShortcode(id),shortcode=self.parseShortcode(shortcodeText);if($.isEmptyObject(shortcode)){return}
shortcode.atts=' '+self.buildAtts($.extend(self.getElmValues(id),values));var newContent=(self.pageData.content||'').replace(shortcodeText,self.buildShortcode(shortcode));self.pageData.content=newContent;$usb.trigger('builder.contentChange')},_cacheDragProcessData:function(callback,key,defaultValue){var self=this;if(!$.isFunction(callback)){return defaultValue}
if(self.isMode('drag:add','drag:move')){return $usbcore.cache('dragProcessData').get(key,callback)}
return callback.call(self)},_renderShortcode:function(requestId,settings){var self=this;if(!requestId||$.isEmptyObject(settings)){return}
if(!$.isPlainObject(settings.data)){settings.data={}}
$.extend(settings.data,{_nonce:$usb.config('_nonce'),action:$usb.config('action_render_shortcode')});if($ush.isUndefined(settings.data.content)){settings.data.content=''}else{settings.data.content+=''}
$usb.ajax(requestId,settings)},_updateColumnsLayout:function(rowId,layout){if('custom'===layout){return}
var self=this,columns=self.getElmChildren(rowId),columnsCount=columns.length,renderNeeded=!1,columnType=self.isRow(rowId)?'vc_column':'vc_column_inner',newColumnsWidths=[],newColumnsWidthsBase=0,newColumnsWidthsTmp,newColumnsCount;layout=''+layout;if(layout.indexOf('-')>-1){newColumnsWidthsTmp=layout.split('-');newColumnsCount=newColumnsWidthsTmp.length;for(var i=0;i<newColumnsCount;i ++){newColumnsWidthsBase+=$ush.parseInt(newColumnsWidthsTmp[i])}
for(var i=0;i<newColumnsCount;i ++){var columnWidthBaseTmp=newColumnsWidthsBase/newColumnsWidthsTmp[i];if(columnWidthBaseTmp%1===0){newColumnsWidths.push('1/'+columnWidthBaseTmp)}else{newColumnsWidths.push(newColumnsWidthsTmp[i]+'/'+newColumnsWidthsBase)}}}else if(layout.indexOf('(')===-1&&layout.indexOf('fr')>-1){var customColumns=$.trim(layout).split(' ');newColumnsCount=0;for(var i in customColumns){var columnName=customColumns[i];if(columnName.indexOf('fr')>-1){newColumnsWidths.push('1/1');newColumnsCount++}}}else{newColumnsCount=$ush.parseInt(layout);for(var i=0;i<newColumnsCount;i ++){newColumnsWidths.push('1/'+layout)}}
if(columnsCount<newColumnsCount){for(var i=columnsCount;i<newColumnsCount;i ++){var newColumnId=self.getSpareElmId(columnType);self._addShortcodeToContent(rowId,i,'['+columnType+' usbid="'+newColumnId+'"][/'+columnType+']')}
columnsCount=newColumnsCount;renderNeeded=!0}else if(columnsCount>newColumnsCount){var columnsCountDifference=columnsCount-newColumnsCount;for(var i=columnsCount-1;(i>=0)&&(columnsCountDifference>0);i --){var columnChildren=self.getElmChildren(columns[i]);if(columnChildren.length===0){self.removeElm(columns[i]);columnsCountDifference--}}
columnsCount=newColumnsCount+columnsCountDifference}
columns=self.getElmChildren(rowId);$usb.trigger('builder.contentChange');for(var i=0;i<columnsCount;i ++){self.setElmValues(columns[i],{width:newColumnsWidths[i%newColumnsWidths.length]})}
if(!renderNeeded){$usb.postMessage('vcColumnChanged',rowId)}else{$usb.postMessage('showPreloader',rowId);self._renderShortcode('_renderShortcode',{data:{content:self.getElmShortcode(rowId)},success:function(res){if(res.success){$usb.postMessage('updateSelectedElm',[rowId,''+res.data.html])}}})}},getInsertPosition:function(parent,index){var position,self=this,isRootElmContainer=self.isElmContainer(parent);index=$ush.parseInt(index);if(self.isMainContainer(parent)||isRootElmContainer){var children=self.getElmChildren(parent);if(index===0||children.length===0){position='prepend'}else if(index>children.length||children.length===1){index=children.length;position='append'}else{parent=children[index-1]||parent;position='after'}}else{position=(index<1?'before':'after')}
return{position:position,parent:parent}},_addShortcodeToContent:function(parent,index,newShortcode){var self=this;if(!newShortcode||!(self.isValidId(parent)||self.isMainContainer(parent))){return!1}
var insertPosition=self.getInsertPosition(parent,index);parent=insertPosition.parent;var insertShortcode='',isMainContainer=self.isMainContainer(parent),oldShortcode=!isMainContainer?self.getElmShortcode(parent):self.pageData.content||'',elmType=!isMainContainer?self.getElmType(parent):'';oldShortcode=self.removeHtmlWrap(oldShortcode);var position=insertPosition.position;if(isMainContainer){position=$usbcore.indexOf(position,['before','after'])>-1?'container:prepend':'container:'+position}
switch(position){case 'before':case 'container:prepend':insertShortcode=newShortcode+oldShortcode;break;case 'prepend':insertShortcode=oldShortcode.replace(new RegExp('^(\\['+elmType+'.*?[\\^\\]]+)'),"$1"+newShortcode.replace('$1','&dollar;1'));break;case 'append':if(self.parseShortcode(oldShortcode).hasClosingTag){insertShortcode=oldShortcode.replace(new RegExp('(\\[\\/'+elmType+'\])$'),newShortcode.replace('$1','&dollar;1')+"$1")}else{insertShortcode=oldShortcode+newShortcode}
break;case 'after':case 'container:append':default:insertShortcode=oldShortcode+newShortcode}
self.pageData.content=(''+self.pageData.content).replace(oldShortcode,insertShortcode);return!0},_addRowWrapper:function(content){var self=this;return $usb.buildString($usb.config('template.vc_row',''),{vc_row:self.getSpareElmId('vc_row'),vc_column:self.getSpareElmId('vc_column'),content:''+content})},_getDefaultContent:function(elmType){var self=this,child,shortcodeSettings=$usb.config('shortcode',{}),_getDefaultContent=function(type){var defaultValues=(shortcodeSettings.default_values||{})[type]||!1,editContent=(shortcodeSettings.edit_content||{})[type]||!1;if(editContent&&defaultValues&&defaultValues[editContent]){return defaultValues[editContent]}
return ''};var asChild=$.extend({},shortcodeSettings.relations.as_child||{});for(var k in asChild){if(((asChild[k].only||'').split(',')).indexOf(elmType)>-1){child=k;break}}
if(!child){return _getDefaultContent(elmType)}
if(self.isElmSection(child)){var titleTemplate=$usb.getTextTranslation('section'),params={title_1:(titleTemplate+' 1'),title_2:(titleTemplate+' 2'),vc_column_text:self.getSpareElmId('vc_column_text'),vc_column_text_content:_getDefaultContent('vc_column_text'),vc_tta_section_1:self.getSpareElmId(child),vc_tta_section_2:self.getSpareElmId(child)};return $usb.buildString($usb.config('template.'+child,''),params)}else{return '['+child+' usbid="'+self.getSpareElmId(child)+'"][/'+child+']'}},createElm:function(type,parent,index,values,callback){var self=this,args=arguments,isMainContainer=self.isMainContainer(parent);if(!type||!parent||!(self.isValidId(parent)||isMainContainer)){$usb.log('Error: Invalid params',args);return}
if(self.hasSameTypeParent(type,parent)){$usb.log('Error: It is forbidden to add inside the same type',args);return}
$usb.postMessage('doAction','hideHighlight');index=$ush.parseInt(index);if(!isMainContainer&&!self.doesElmExist(parent)){parent=self.mainContainer;index=0}
var elmId=self.getSpareElmId(type),elmName=self.getElmName(elmId),insert=self.getInsertPosition(parent,index);if(!values||$.isEmptyObject(values)){values={};var defaultValues=$usb.config('shortcode.default_values.'+elmName,!1);if(defaultValues){for(var _attr in defaultValues){if(defaultValues.hasOwnProperty(_attr)&&_attr!=='content'){values[_attr]=defaultValues[_attr]}}}}
var buildShortcode=self.buildShortcode({tag:type,atts:self.buildAtts($.extend({usbid:elmId},values)),content:self._getDefaultContent(elmName),hasClosingTag:(self.isElmContainer(elmName)||!!$usb.config('shortcode.edit_content.'+elmName))});if(self.isMainContainer(parent)&&!self.isRow(elmId)&&!$usb.templates.isTemplate(type)){buildShortcode=self._addRowWrapper(buildShortcode)}
if(!self._addShortcodeToContent(parent,index,buildShortcode)){return!1}
$usb.postMessage('showPreloader',[insert.parent,insert.position,self.isElmContainer(type)]);self._renderShortcode('_renderShortcode',{data:{content:buildShortcode},success:function(res){$usb.postMessage('hidePreloader',insert.parent);if(res.success){$usb.postMessage('insertElm',[insert.parent,insert.position,''+res.data.html]);$usb.postMessage('maybeInitElmJS',[elmId]);$usb.trigger('builder.contentChange');$usb.history.commitChange(elmId,_CHANGED_ACTION_.CREATE)}
if($.isFunction(callback)){callback.call(self,elmId)}}});return elmId},moveElm:function(moveId,newParent,newIndex){var self=this,args=arguments;if(self.isMainContainer(moveId)){$usb.log('Error: Cannot move the container',args);return!1}
var isMainContainer=self.isMainContainer(newParent);if(self.hasSameTypeParent(moveId,newParent)){$usb.log('Error: It is forbidden to add inside the same type',args);return}
if(!self.isValidId(moveId)||!(self.isValidId(newParent)||isMainContainer)){$usb.log('Error: Invalid ID specified',args);return!1}
if(!self.doesElmExist(moveId)||!(self.doesElmExist(newParent)||isMainContainer)){$usb.log('Error: Element doesn\'t exist',args);return!1}
newIndex=$ush.parseInt(newIndex);$usb.postMessage('doAction','hideHighlight');if(!isMainContainer&&!self.doesElmExist(newParent)){newParent=self.mainContainer;newIndex=0}
$usb.history.commitChange(moveId,_CHANGED_ACTION_.MOVE);var oldShortcode=self.getElmShortcode(moveId);self.pageData.content=(''+self.pageData.content).replace(oldShortcode,'');var insert=self.getInsertPosition(newParent,newIndex);if(!self._addShortcodeToContent(newParent,newIndex,oldShortcode)){return!1}
$usb.postMessage('moveElm',[insert.parent,insert.position,moveId]);$usb.trigger('builder.contentChange');return!0},removeElm:function(removeId){var self=this;if(!self.isValidId(removeId)){return!1}
$usb.postMessage('removeHtmlById',removeId);var selectedElmId=self.selectedElmId,allChildren=self.getElmAllChildren(removeId),rootContainerId;if(self.isColumn(removeId)){rootContainerId=self.getElmParentId(removeId)}
$usb.history.commitChange(removeId,_CHANGED_ACTION_.REMOVE);self.pageData.content=(''+self.pageData.content).replace(self.getElmShortcode(removeId),'');$usb.trigger('builder.contentChange');if(rootContainerId){$usb.postMessage('vcColumnChanged',rootContainerId)}
if(selectedElmId&&(removeId==selectedElmId||allChildren.indexOf(selectedElmId)>-1)){$usb.trigger('panel.showAddElms')}
$usb.navigator.removeElm(removeId);return!0}});$usb.builder=new Builder('#usb-wrapper')}(jQuery);!function($,undefined){var _window=window,_document=document;if(!_window.$usb){return}['$ush','$usbcore'].map(function(name){_window[name]=_window[name]||{}});const _REGEXP_USBID_ATTR_=/(\s?usbid="([^\"]+)?")/g;var _$temp={elmsFieldset:{},isFieldsetsLoaded:!1,};function BuilderPanel(){var self=this;self.activeElmFieldset;self.$activeElmFieldset;self._events={contentChange:self._contentChange.bind(self),iframeReady:self._iframeReady.bind(self),resetSearch:self._resetSearch.bind(self),saveChanges:self._saveChanges.bind(self),searchElms:self._searchElms.bind(self),showAddElms:self._showAddElms.bind(self),submitPreviewChanges:self._submitPreviewChanges.bind(self),switchPanel:self._switchPanel.bind(self),switchTabs:self.$$fieldsets._switchTabs.bind(self),urlManager:self._urlManager.bind(self),changeImportContent:self._changeImportContent.bind(self),saveImportContent:self._saveImportContent.bind(self),showImportContent:self._showImportContent.bind(self),afterHideField:self._afterHideField.bind(self),changeDesignField:self._changeDesignField.bind(self),changeField:self._changeField.bind(self),};$(function(){self.$tabElements=$('.usb-panel-tab-elements',$usb.$panel);self.$elms=$('.usb-panel-elms',$usb.$panel);self.$searchElms=$('[data-search-text]',$usb.$panel);self.$searchField=$('input[name=search]',$usb.$panel);self.$searchNoResult=$('.usb-panel-elms-search-noresult',$usb.$panel);self.$importContent=$('.usb-panel-import-content',$usb.$panel);self.$importTextarea=$('.usb-panel-import-content textarea:first',$usb.$panel);self.$actionSaveImportContent=$('.usb_action_save_import_content',$usb.$panel);self.$actionAddElms=$('.usb_action_show_add_elms',$usb.panel.$header);self.$actionTabAddElms=$('.usb_action_tab_add_elms',self.$tabElements);if($usb.panel.isShow()){$usb.builder.setMode('editor')}
$usb.$panel.on('click','.usof-tabs-item',self._events.switchTabs).on('input','input[name=search]',$ush.debounce(self._events.searchElms,1)).on('click','.usb_action_panel_reset_search',self._events.resetSearch).on('click','.usb_action_show_add_elms',self._events.showAddElms).on('click','.usb_action_tab_add_elms',self._events.showAddElms).on('submit','form#wp-preview',self._events.submitPreviewChanges).on('click','.usb_action_show_import_content',self._events.showImportContent).on('change input blur','.usb-panel-import-content textarea',self._events.changeImportContent).on('click','.usb_action_save_import_content',self._events.saveImportContent);self._urlManager($usb.urlManager.getDataOfChange())});$usb.on('iframeReady',self._events.iframeReady).on('builder.contentChange',self._events.contentChange).on('panel.switch',self._events.switchPanel).on('panel.showAddElms',self._events.showAddElms).on('panel.clearBody',self.clearBody.bind(self)).on('panel.saveChanges',self._events.saveChanges).on('hotkeys.ctrl+s',self._events.saveChanges).on('urlManager.changed',self._events.urlManager)}
var prototype=BuilderPanel.prototype;$.extend(prototype,$ush.mixinEvents,{clearBody:function(){var self=this;self._hideImportContent();self._hideAddElms();self._destroyElmFieldset()},_switchPanel:function(){var isShow=$usb.panel.isShow(),doActionArgs='hideEditableHighlight',selectedElmId=$usb.find('builder.selectedElmId');if(isShow&&selectedElmId){doActionArgs=['showEditableHighlight',selectedElmId]}
$usb.postMessage('doAction',doActionArgs);$usb.builder.setMode(isShow?'editor':'preview')},_searchElms:function(){var self=this,$input=self.$searchField,isFoundResult=!0,value=$ush.toLowerCase(($input[0].value||'').trim());$input.next('.usb_action_panel_reset_search').toggleClass('hidden',!value);self.$searchElms.toggleClass('hidden',!!value);if(value){isFoundResult=!!self.$searchElms.filter('[data-search-text^="'+value+'"], [data-search-text*="'+value+'"]').removeClass('hidden').length}
$('.usb-panel-elms-list',self.$elms).each(function(_,list){var isEmptyList=!$('[data-search-text]:not(.hidden)',list).length;$(list).toggleClass('hidden',isEmptyList).prev('.usb-panel-elms-header').toggleClass('hidden',isEmptyList)});self.$searchNoResult.toggleClass('hidden',isFoundResult)},_resetSearch:function(){var self=this,$input=self.$searchField;if(!$input.val()){return}
$input.val('').trigger('input')},_submitPreviewChanges:function(e){var self=this;$('textarea[name="post_content"]',e.target).val($usb.builder.pageData.content);$('textarea[name='+$usb.config('keyCustomCss','')+']',e.target).val($usb.builder.pageData.customCss)},_saveChanges:function(){var self=this;if($usb.urlManager.hasParam('active','site_settings')||!$usb.builder.isPageChanged()||$usb.builder.isProcessSave()){return}
$usb.panel.switchSaveButton(!0,!0);$usb.builder.savePageData(function(){$usb.panel.switchSaveButton(!1)})},_contentChange:function(){$usb.panel.switchSaveButton($usb.builder.isPageChanged())},_showAddElms:function(){$usb.urlManager.removeParam('active').push();this.showAddElms()},showAddElms:function(){var self=this,$actionAddElms=self.$actionAddElms;$usb.trigger('panel.clearBody');$usb.navigator.resetActive();$usb.postMessage('doAction','hideHighlight');$usb.builder.setMode('editor');$actionAddElms.addClass('active');$ush.timeout(function(){self.$searchField.focus()},10);self.$tabElements.removeClass('hidden');if(!self.$actionTabAddElms.hasClass('active')){self.$actionTabAddElms.trigger('click')}
$usb.panel.setTitle($actionAddElms.attr('title'));$usb.builder._initDragDrop()},_hideAddElms:function(){var self=this;if(!$usb.panel.isReady()){return}
self.$actionAddElms.removeClass('active');self.$tabElements.addClass('hidden');$usb.builder._destroyDragDrop()},_urlManager:function(state){var self=this,setParams=state.setParams;if(!$usb.panel.isReady()){return}
if(!setParams.active&&!$usb.find('builder.selectedElmId')&&setParams.action!=$usb.config('actions.site_settings')){self.showAddElms()}
else if(setParams.active=='paste_row'){self.showImportContent()}}});$.extend(prototype,{showImportContent:function(){var self=this;self.clearBody();$usb.builder.setMode('editor');$usb.navigator.resetActive();self.$importContent.removeClass('hidden');self.$importTextarea.val('').focus().removeClass('validate_error');self.$actionSaveImportContent.prop('disabled',!0).addClass('disabled');$usb.panel.setTitle('paste_row',!0)},_showImportContent:function(){$usb.urlManager.setParam('active','paste_row').push()},_hideImportContent:function(){var self=this;if($usb.panel.isReady()){self.$importContent.addClass('hidden')}},_changeImportContent:function(e){var self=this;$usb.notify.closeAll();var target=e.target,pastedContent=target.value.trim();if(pastedContent.indexOf('usbid=')!==-1){pastedContent=pastedContent.replace(_REGEXP_USBID_ATTR_,'')}
if(target.value!==pastedContent){target.value=pastedContent}
$(target).removeClass('validate_error');self.$actionSaveImportContent.prop('disabled',!pastedContent).toggleClass('disabled',!pastedContent)},_saveImportContent:function(){var self=this,$textarea=self.$importTextarea,$saveButton=self.$actionSaveImportContent,pastedContent=$textarea.val()||'';if(!pastedContent){$saveButton.prop('disabled',!0).addClass('disabled');return}
pastedContent=$usb.builder.removeHtmlWrap(pastedContent);var isValid=!(!/^\[vc_row([\s\S]*)\/vc_row\]$/gim.test(pastedContent)||pastedContent.indexOf('[vc_column')===-1);$textarea.toggleClass('validate_error',!isValid);if(!isValid){$usb.notify.add($usb.getTextTranslation('invalid_data'),_NOTIFY_TYPE_.ERROR);return}
$textarea.prop('disabled',!0).addClass('disabled');$saveButton.addClass('loading disabled').prop('disabled',!0);var elmId;pastedContent=pastedContent.replace(/\[(\w+)/g,function(match,tag,offset){var id=$usb.builder.getSpareElmId(tag);if(0===offset){elmId=id}
return match+' usbid="'+id+'"'});var placeholder=$usb.config('placeholder','');pastedContent=pastedContent.replace(/use:placeholder/g,placeholder);pastedContent=pastedContent.replace(/css="([^\"]+)"/g,function(matches,match){if(match){var jsoncss=(decodeURIComponent(match)||'').replace(/("background-image":")(.*?)(")/g,function(_,before,id,after){return before+($ush.parseInt(id)||placeholder)+after});return 'css="%s"'.replace('%s',encodeURIComponent(jsoncss))}
return matches});pastedContent=pastedContent.replace(/\s?post_type="(.*?)"/g,function(match,post_type){if($usb.config('grid_post_types',[]).indexOf(post_type)===-1){return ' post_type="post"'}
return match});$usb.builder._renderShortcode('_renderPastedContent',{data:{content:pastedContent,isReturnContent:!0,},success:function(res){if(!res.success||!res.data.html){return}
$usb.history.commitChange(elmId,_CHANGED_ACTION_.CREATE);$usb.builder.pageData.content+=(res.data.content||pastedContent.replace(/(grid_layout_data="([^"]+)")/g,'items_layout=""'));$usb.postMessage('insertElm',[$usb.builder.mainContainer,'append',res.data.html,!0]);$usb.trigger('builder.contentChange')},complete:function(_,textStatus){var isSuccess=(textStatus==='success');$saveButton.prop('disabled',isSuccess).removeClass('loading').toggleClass('disabled',isSuccess);$textarea.prop('disabled',!1).removeClass('disabled');if(isSuccess){$textarea.val('')}}})}});$.extend(prototype,{_loadDeferredFieldsets:function(name){var self=this;$usb.$panel.addClass('data_loading');var data={},requestId='loadDeferredFieldsets';if(!$ush.isUndefined(name)){data.name=name;requestId+='.name';$usb.$panel.addClass('show_preloader')}
$usb.ajax(requestId,{data:$.extend(data,{_nonce:$usb.config('_nonce'),action:$usb.config('action_get_deferred_fieldsets'),}),success:function(res){if(!res.success){return}
var fieldsets=$.isPlainObject(res.data)?res.data:{};for(var name in fieldsets){if(!!_$temp.elmsFieldset[name]){continue}
_$temp.elmsFieldset[name]=fieldsets[name];self.trigger('fieldsetLoaded',[name]);}
var removeClasses='data_loading';if(!data.name){_$temp.isFieldsetsLoaded=!0;removeClasses+=' show_preloader'}else{removeClasses=' show_preloader'}
$usb.$panel.removeClass(removeClasses)}})},_iframeReady:function(){var self=this;$ush.timeout(self._loadDeferredFieldsets.bind(self),100)},initElmFieldset:function(id,callback){var self=this;if(!$usb.builder.doesElmExist(id)){return}
$usb.urlManager.removeParam('active').push();var name=$usb.builder.getElmName(id),elmsSupported=$usb.config('elms_supported',[]),elmTitle=$usb.config('elm_titles.'+name,name);if(!$.isArray(elmsSupported)||$usbcore.indexOf(name,elmsSupported)<0){$usb.panel.setTitle(elmTitle);$usb.panel.showMessage($usb.getTextTranslation('editing_not_supported'));self.navigator.setActive(id,!0);$usb.postMessage('doAction',['showEditableHighlight',id]);return}
if(!_$temp.elmsFieldset[name]){$('#usb-tmpl-fieldsets .usb-panel-fieldset[data-name]',$usb.$panel).each(function(_,node){_$temp.elmsFieldset[$(node).data('name')]=node.outerHTML}).remove()}
if(!_$temp.elmsFieldset[name]&&!_$temp.isFieldsetsLoaded){$usb.panel.setTitle(elmTitle);self.one('fieldsetLoaded',function(loadedName){if(name!==loadedName)return;self._showElmFieldset(id)});self._loadDeferredFieldsets(name);return}
self._showElmFieldset(id)},_showElmFieldset:function(id){var self=this;if(!$usb.builder.doesElmExist(id)){return}
var name=$usb.builder.getElmName(id),values=$usb.builder.getElmValues(id)||{};if(!name){return}
if($usb.$panel.hasClass('show_preloader')){$usb.$panel.removeClass('show_preloader')}
$usb.trigger('panel.clearBody');if($usb.config('dynamicFieldsetAssets.codeEditor',[]).indexOf(name)>-1){self._loadAssetsForCodeEditor()}
self.$activeElmFieldset=$(_$temp.elmsFieldset[name]);$usb.$panelBody.prepend(self.$activeElmFieldset);$usb.builder.selectedElmId=id;self.activeElmFieldset=new $usof.GroupParams(self.$activeElmFieldset);$usb.panel.setTitle($usb.builder.getElmTitle(id));self.$activeElmFieldset.addClass('inited usof-container');self.activeElmFieldset.setValues(values,!0);if($usb.find('preview')){$usb.preview.setFieldResponsiveScreen()}
for(var fieldId in self.activeElmFieldset.fields){var field=self.activeElmFieldset.fields[fieldId];field.on('change',self._events.changeField.bind(self,id)).on('afterHide',self._events.afterHideField).on('changeDesignField',self._events.changeDesignField.bind(self,id)).on('syncResponsiveState',function(_,screenName){if($usb.find('preview')){$usb.preview.fieldSetResponsiveScreen(screenName)}}).on('tinyMCE.Keydown',function(_,e){$usb._events.keydown(e)})}
for(var groupName in(self.activeElmFieldset.groups||{})){self.activeElmFieldset.groups[groupName].on('change',$ush.debounce(self._events.changeField.bind(self,id),1))}
if(self.activeElmFieldset.isGroupParams){self.activeElmFieldset.$tabsItems=$('.usof-tabs-item',self.$activeElmFieldset);self.activeElmFieldset.$tabsSections=$('.usof-tabs-section',self.$activeElmFieldset);self.$$fieldsets.autoShowingTabs()}
$usb.builder.trigger('panel.afterInitFieldset');$usb.postMessage('doAction',['showEditableHighlight',id])},_destroyElmFieldset:function(){var self=this;if(!$usb.panel.isReady()||!self.activeElmFieldset){return}
if(self.$activeElmFieldset instanceof $){self.$activeElmFieldset.remove()}
$usb.$document.off('usb.syncResponsiveState');$usb.postMessage('doAction','hideEditableHighlight');$usb.builder.selectedElmId=null;self.activeElmFieldset=null;self.$activeElmFieldset=null},_loadAssetsForCodeEditor:function(){var codeEditorAssets=(_window.$usbdata.deferredAssets||{})['codeEditor']||'';if(codeEditorAssets){$usb.$body.append(codeEditorAssets);delete _window.$usbdata.deferredAssets.codeEditor}},_changeDesignField:function(selectedElmId,field,designField){if(field.type!=='design_options'){return}
this._changeField(selectedElmId,designField,designField.getValue(),!0)},__updateColumnsLayout:$ush.debounce(function(id,layout){$usb.builder._updateColumnsLayout(id,layout)},1),__updateShortcode:$ush.throttle($ush.fn,1,!0),__updateShortcode_long:$ush.debounce($ush.fn,150),__updateOnInstructions_long:$ush.throttle($ush.fn,1000),_changeField:function(selectedElmId,usofField,_,_skipSave){var self=this;self.$$fieldsets.autoShowingTabs.call(self);if(!selectedElmId||selectedElmId!==$usb.builder.selectedElmId){return}
var isGroup=usofField instanceof $usof.Group,isField=usofField instanceof $usof.field;if(!(isField||isGroup)){return}
var value=usofField.getValue(),fieldType=(isField?usofField.type:'group'),usbParams=usofField[isField?'$row':'$field'].data('usb-params')||{},instructions=$usb._normalizeInstructions(usbParams.usb_preview);var _currentData={elmType:$usb.builder.getElmType(selectedElmId),fieldType:fieldType,id:selectedElmId,instructions:instructions,isChangeDesignOptions:(fieldType==='design_options'),isResponsiveValue:(isField?usofField.isResponsiveValue(value):!1),name:(usofField.name||usofField.groupName),usofField:usofField,value:value,};if($.isArray(instructions)){var previewCallbacks=$.isPlainObject(_window.$usbdata.previewCallbacks)?_window.$usbdata.previewCallbacks:{};for(var i in instructions){var funcName=$ush.toLowerCase(_currentData.elmType+'_'+_currentData.name);if(!instructions[i].callback||!$.isFunction(previewCallbacks[funcName])){continue}
try{instructions=previewCallbacks[funcName](_currentData.value)||!0}catch(err){$usb.log('Error executing callback function in instructions',err)}}
_currentData.instructions=$usb._normalizeInstructions(instructions)}
if((_currentData.isChangeDesignOptions&&$ush.rawurldecode(value).indexOf('"background-image":"{{')>-1)||(_currentData.name==='background-image'&&$ush.toString(value).indexOf('{{')>-1)){instructions=!0;_skipSave=!1}
_currentData.isActiveRecoveryTask=$usb.history.isActiveRecoveryTask();var _updateShortcode=function(_currentData){var originalId=_currentData.id,oldShortcode=$usb.builder.getElmShortcode(originalId);if(!oldShortcode||_skipSave){return{}}
var shortcodeObj=$usb.builder.parseShortcode(oldShortcode),isShortcodeContent=(_currentData.fieldType==='editor'||_currentData.name==='content');var atts=$usb.builder.parseAtts(shortcodeObj.atts);if(isShortcodeContent||_currentData.usofField.getDefaultValue()===_currentData.value){delete atts[_currentData.name]}else{atts[_currentData.name]=_currentData.value}
shortcodeObj.atts=$usb.builder.buildAtts(atts);if(isShortcodeContent){shortcodeObj.content=_currentData.value}
var newShortcode=$usb.builder.buildShortcode(shortcodeObj),hasChanged=(oldShortcode!==newShortcode&&!_currentData.isActiveRecoveryTask),oldParentShortcode;if(_currentData.instructions===!0&&$usb.builder.isUpdateIncludeParent(originalId)){_currentData.id=$usb.builder.getElmParentId(_currentData.id);oldParentShortcode=$usb.builder.getElmShortcode(_currentData.id)}
if(hasChanged){$usb.builder.pageData.content=(''+$usb.builder.pageData.content).replace(oldShortcode,newShortcode);$ush.debounce_fn_1ms(function(){$usb.trigger('builder.contentChange')})}
if(oldParentShortcode){oldShortcode=oldParentShortcode;newShortcode=$usb.builder.getElmShortcode(_currentData.id)}
if(hasChanged&&_currentData.elmType.indexOf('vc_row')===0&&['columns','columns_layout'].indexOf(_currentData.name)>-1){self.__updateColumnsLayout(_currentData.id,_currentData.value)}
if(hasChanged){_$temp._latestShortcodeUpdates={content:oldShortcode,preview:$usb.builder.getElmOuterHtml(_currentData.id)};var commitArgs=[_currentData.id,_CHANGED_ACTION_.UPDATE];commitArgs.push($usb.config('useThrottleForFields',[]).indexOf(_currentData.usofField.type)>-1);if(oldParentShortcode){commitArgs.push({originalId:originalId})}
$usb.history.commitChange.apply($usb.history,commitArgs)}
if(!hasChanged&&!_currentData.isActiveRecoveryTask&&_currentData.isChangeDesignOptions){hasChanged=!0}
return{changed:hasChanged,new:newShortcode,old:oldShortcode}};var cache=$usbcore.cache('_changeField');if(_skipSave!==!0&&instructions===!0&&!_currentData.isActiveRecoveryTask){var _shortcode=_updateShortcode(_currentData);if(_shortcode.changed&&instructions===!0){cache.set('shortcodeChanged',instructions)}
self.__updateShortcode_long(function(){if(!_shortcode.changed&&!cache.get('shortcodeChanged')){return}
cache.flush();$usb.postMessage('showPreloader',_currentData.id);$usb.builder._renderShortcode('_renderShortcode',{data:{content:_shortcode.new},success:function(res){if(!res.success){return}
var html=(''+res.data.html).replace(/(class=".*?animate_this)/i,"$1 start");$usb.postMessage('updateSelectedElm',[_currentData.id,html]);$usb.builder.trigger('shortcodeChanged',_currentData)}})})}
else if(instructions!==!0){var _updateOnInstructions=function(_currentData){var _shortcode=_updateShortcode(_currentData);if(!_shortcode.changed||$ush.isUndefined(_currentData.instructions)){return}
if(_currentData.isResponsiveValue){_currentData.value=$ush.toPlainObject(_currentData.value)}
$usb.postMessage('onPreviewParamChange',[_currentData.id,_currentData.instructions,_currentData.value,_currentData.fieldType,_currentData.isResponsiveValue]);$usb.builder.trigger('shortcodeChanged',_currentData)};var _switchUpdateOnInstructions=function(){if(_skipSave===!0){return}
if($usb.config('useLongUpdateForFields',[]).indexOf(_currentData.usofField.type)>-1){self.__updateOnInstructions_long(_updateOnInstructions.bind(self,_currentData))}else{_updateOnInstructions(_currentData)}};if(_currentData.isChangeDesignOptions){var _value=unescape(''+_currentData.value);var attachmentId=$ush.parseInt((_value.match(/"background-image":"(\d+)"/)||[])[1]);if(attachmentId&&!$usb.getAttachmentUrl(attachmentId)){($usb.getAttachment(attachmentId)||{fetch:$.noop}).fetch({success:_switchUpdateOnInstructions})}else{_switchUpdateOnInstructions()}}else{_switchUpdateOnInstructions()}}},_afterHideField:function(usofField){if(usofField instanceof $usof.field&&usofField.inited){usofField.setValue(usofField.getDefaultValue(),!1)}}});prototype.$$fieldsets={_switchTabs:function(e){var $target=$(e.currentTarget),$sections=$target.parents('.usof-tabs:first').find('> .usof-tabs-sections > *');$target.addClass('active').siblings().removeClass('active');$sections.removeAttr('style').eq($target.index()).addClass('active').siblings().removeClass('active')},autoShowingTabs:function(){var self=this;if(!self.activeElmFieldset||!self.activeElmFieldset.isGroupParams){return}
$.each(self.activeElmFieldset.$tabsSections,function(index,section){var fields=$('> *',section).toArray(),isHidden=!0;for(var k in fields){var $field=$(fields[k]),isShown=$field.data('isShown');if($ush.isUndefined(isShown)){isShown=($field.css('display')!='none')}
if(isShown){isHidden=!1;break}}
self.activeElmFieldset.$tabsItems.eq(index).toggleClass('hidden',isHidden)})}};$usb.builderPanel=new BuilderPanel}(jQuery);!function($,undefined){var _window=window;if(!_window.$usb){return}['$ush','$usbcore'].map(function(name){_window[name]=_window[name]||{}});var _$temp={template:''};function Navigator(container){var self=this;self._events={contentChange:self._contentChange.bind(self),duplicateElm:self._duplicateElm.bind(self),expand:self._expand.bind(self),expandAll:self._expandAll.bind(self),hide:self._hide.bind(self),iframeReady:self._iframeReady.bind(self),panelShowMessage:self._panelShowMessage.bind(self),removeElm:self._removeElm.bind(self),scrollTo:self._scrollTo.bind(self),selectedElm:self._selectedElm.bind(self),shortcodeChanged:self._shortcodeChanged.bind(self),showPreloader:self._showPreloader.bind(self),switch:self._switch.bind(self),urlManager:self._urlManager.bind(self),};$(function(){self.$container=$(container);self.$body=$('.usb-navigator-body',self.$container);self.$actionHide=$('.usb_action_navigator_hide',self.$container);self.$actionSwitch=$('.usb_action_switch_navigator',$usb.$panel);self.$actionExpandAll=$('.usb_action_navigator_expand_all',self.$container);self.$container.on('click','.usb_action_navigator_hide',self._events.hide).on('click','.usb_action_navigator_expand_all',self._events.expandAll).on('click','.usb_action_navigator_expand',self._events.expand).on('click','.usb-navigator-item-header',$ush.debounce(self._events.selectedElm,0.5)).on('click','.usb_action_navigator_duplicate_elm',self._events.duplicateElm).on('click','.usb_action_navigator_remove_elm',self._events.removeElm);$usb.$panel.on('click','.usb_action_switch_navigator',self._events.switch);var $template=$('#usb-tmpl-navigator-item',self.$container);if($template.length){_$temp.template=$template.html();$template.remove()}});self.on('showPreloader',self._events.showPreloader);$usb.on('iframeReady',self._events.iframeReady).on('builder.contentChange',self._events.contentChange).on('navigator.scrollTo',self._events.scrollTo).on('navigator.showPreloader',self._events.showPreloader).on('shortcodeChanged',self._events.shortcodeChanged).on('panel.showMessage',self._events.panelShowMessage).on('urlManager.changed',self._events.urlManager)}
$.extend(Navigator.prototype,$ush.mixinEvents,{isReady:function(){return!$ush.isUndefined(this.$container)},isShow:function(){return $usb.urlManager.hasParam('navigator','show')},_switch:function(){var urlManager=$usb.urlManager;if(!this.isShow()){urlManager.setParam('navigator','show')}else{urlManager.removeParam('navigator')}
urlManager.push()},_hide:function(){$usb.urlManager.removeParam('navigator').push()},show:function(){var self=this;if($usb.builder.isEmptyContent()){return}
self.$container.addClass('show');self.$actionSwitch.addClass('active');self.redraw()},hide:function(){var self=this;self.$container.removeClass('show');self.$actionSwitch.removeClass('active')},_scrollTo:function(id){var self=this;if(!self.isShow()||!$usb.builder.isValidId(id)){return}
var $body=self.$body,$item=$('[data-for="'+id+'"]',$body);if(!$item.length){return}
var rect=$ush.$rect($item[0]);if(!(rect.top<0||rect.bottom>($body.height()||rect.height))){return}
var headerHeight=$('.usb-navigator-header',self.$container).height();$body[0].scrollTo(0,rect.top+$body.scrollTop()-headerHeight)},_showPreloader:function(id){var self=this;if(!self.isShow()||!$usb.builder.doesElmExist(id)){return}
var $item=$('[data-for="'+id+'"]',self.$body),$duplicateItem=$item.clone().removeAttr('data-for').removeClass('expand active').addClass('duplicate');$('> .usb-navigator-item-header .usb-navigator-item-title > i',$duplicateItem).after('<span class="usof-preloader"></span>').addClass('hidden');$item.after($duplicateItem)},_expand:function(e){var $item=$(e.target).closest('[data-for]');if($item.length){$item.toggleClass('expand',!$item.hasClass('expand'))}},_expandAll:function(){var self=this,$action=self.$actionExpandAll,$items=$('[data-for].has_children',self.$body).add($action);if(!$action.hasClass('expand')){$items.addClass('expand')}else{$items.removeClass('expand')}},_selectedElm:function(e){var $target=$(e.target),id=$target.closest('[data-for]').data('for');if($target.hasClass('usb_action_navigator_expand')){return}
$ush.timeout(function(){$usb.postMessage('doAction',['scrollToOutsideElm',id])},100);if($usb.builder.selectedElmId!==id){$usb.trigger('builder.elmSelected',id)}},_duplicateElm:function(e){var self=this,id=$(e.target).closest('[data-for]').data('for');if(!$usb.builder.doesElmExist(id)){return!1}
self.trigger('showPreloader',id);$usb.trigger('builder.elmDuplicate',id);return!1},_removeElm:function(e){var self=this,id=$(e.target).closest('[data-for]').data('for');if($usb.builder.doesElmExist(id)){$usb.trigger('builder.elmDelete',id)}},removeElm:function(id){var self=this;if(!self.isShow()||!$usb.builder.isValidId(id)){return}
$('[data-for="'+id+'"]:first',self.$body).remove()},setActive:function(id,expandParents){var self=this;if(!self.isShow()||!$usb.builder.doesElmExist(id)){return}
self.resetActive();$('[data-for="'+id+'"]',self.$body).addClass('active').parents('[data-for]').toggleClass('expand',!!expandParents)},resetActive:function(){var self=this;if(self.isShow()){$('[data-for].active',self.$body).removeClass('active')}},buttonControl:function(isDisabled){this.$actionSwitch.toggleClass('disabled',isDisabled)},redraw:function(){var self=this;if($usb.iframeIsReady!==!0||$usb.builder.isEmptyContent()||!self.isShow()){return}
var getItems=function(elmsId,node,level){if(!$.isArray(elmsId)||elmsId.length===0){return node}
level++;elmsId.map(function(elmId){var attrId=$usb.builder.getElmValue(elmId,'el_id','');var $item=$($usb.buildString(_$temp.template,{attr_id:(attrId?'#'+attrId:''),elm_icon:$usb.config('elm_icons.'+$usb.builder.getElmName(elmId),'no-icon'),elm_title:$usb.builder.getElmTitle(elmId),elm_type:$usb.builder.getElmType(elmId),usbid:elmId,}));var itemChildren=$usb.builder.getElmChildren(elmId);if(itemChildren.length){getItems(itemChildren,$item,level);$item.addClass('has_children').toggleClass('expand',!!$('[data-for="'+elmId+'"].expand',self.$body).length)}
$item.addClass('level_'+level);node.append($item.get(0))});return node}
self.$body.html(getItems($usb.builder.getElmChildren($usb.builder.mainContainer),new DocumentFragment,0));self.setActive($usb.builder.selectedElmId,!0)},_panelShowMessage:function(){this.resetActive()},_shortcodeChanged:function(data){if(!$.isPlainObject(data)){return}
var self=this;if(self.isShow()&&data.name==='el_id'){if(data.value){data.value='#'+data.value}
$('[data-for="'+data.id+'"] .for_attr_id:first',self.$body).text(data.value)}},_contentChange:function(){var self=this;var isEmptyContent=$usb.builder.isEmptyContent();if(isEmptyContent){self.hide()}
self.buttonControl(isEmptyContent);if(!isEmptyContent&&self.isShow()){$ush.debounce_fn_1ms(self.redraw.bind(self))}},_iframeReady:function(){var self=this,isEmptyContent=$usb.builder.isEmptyContent();self.buttonControl(isEmptyContent);if(!isEmptyContent){self._urlManager($usb.urlManager.getDataOfChange())}},_urlManager:function(state){var self=this,urlManager=$usb.urlManager;if(!self.isReady()){return}
if(self.isShow()&&state.setParams.action===$usb.config('actions.site_settings')){self.hide();return}
if(urlManager.hasParam('navigator','show')){self.show()}else{self.hide()}}});$usb.navigator=new Navigator('#usb-navigator')}(jQuery);!function($,undefined){var _window=window,_document=document;if(!_window.$usb){return}['$ush','$usbcore'].map(function(name){_window[name]=_window[name]||{}});const _REGEXP_USBID_ATTR_=/(\s?usbid="([^\"]+)?")/g;var _$temp={$categorySections:{},isLoaded:{},transit:null,};function Templates(container){var self=this;self.name='templates';self._events={clickTabTemplates:self._clickTabTemplates.bind(self),expandCategory:self._expandCategory.bind(self),}
$(function(){self.$container=$(container);self.$tabButton=$('.usb_action_show_templates',$usb.$panel);self.$error=$('.usb-templates-error',self.$container);_$temp.transit=_document.querySelector('.usb-template-transit');$usb.$panel.on('click','.usb-template-title',self._events.expandCategory).on('click','.usb_action_show_templates',self._events.clickTabTemplates)})}
$.extend(Templates.prototype,$ush.mixinEvents,{isReady:function(){return!$ush.isUndefined(this.$container)},isShow:function(){return this.$container.is(':visible')},isTemplate:function(id){var self=this;if($usb.builder.isValidId(id)){id=$usb.builder.getElmType(id)}
return id==='import_template'},configIsLoaded:function(){return!$.isEmptyObject(_$temp.$categorySections)},categoryIsLoaded:function(categoryId){return _$temp.isLoaded.hasOwnProperty(categoryId)},templateIsLoaded:function(categoryId){var self=this;if(self.categoryIsLoaded(categoryId)&&_$temp.isLoaded[categoryId]){return!0}
return!1},showTransit:function(){$usbcore.$removeClass(_$temp.transit,'hidden');return _$temp.transit},hideTransit:function(){$usbcore.$addClass(_$temp.transit,'hidden')},_clickTabTemplates:function(){var self=this;if(!self.configIsLoaded()){self._loadConfig()}
if($usb.licenseIsActivated()){$usb.builder._initDragDrop()}
if($usb.find('builderPanel')){$usb.builderPanel.$actionAddElms.addClass('active')}
$('.usb-template',self.$container).removeClass('expand')},_expandCategory:function(e){var self=this,categoryId=$(e.currentTarget).parent().data('template-category-id');if(!categoryId){return}
if($usb.licenseIsActivated()){self._loadTemplates(categoryId)}
var $activeTemplate=$('.usb-template.expand',self.$container);if($activeTemplate.data('template-category-id')===categoryId){$activeTemplate.removeClass('expand');return}
function showSectionById(categoryId){$('.usb-template',self.$container).removeClass('expand').filter('[data-template-category-id="'+categoryId+'"]').addClass('expand')};if(!self.configIsLoaded()){self.one('configLoaded',showSectionById.bind(self,categoryId))}else{showSectionById(categoryId)}},_loadConfig:function(){var self=this;if(self.configIsLoaded()){return}
$usb.panel.showPreloader();$usb.ajax('templates.loadConfig',{data:{_nonce:$usb.config('_nonce'),action:$usb.config('action_get_templates_config'),},success:function(res){if(!res.success||!$.isPlainObject(res.data)){self.$error.addClass('active');return}
for(categoryId in res.data){if(_$temp.$categorySections[categoryId]){continue}
var categorySection=res.data[categoryId];if(categorySection){self.$container.append(categorySection);_$temp.$categorySections[categoryId]=$(categorySection)}}
self.trigger('configLoaded')},complete:function(){$usb.panel.hidePreloader()},})},_loadTemplates:function(categoryId){var self=this;if($ush.isUndefined(categoryId)||categoryId==''||self.templateIsLoaded(categoryId)){return}
$usb.ajax('templates.loadTemplates',{data:{_nonce:$usb.config('_nonce'),action:$usb.config('action_preload_template_category'),template_category_id:categoryId,},success:function(res){_$temp.isLoaded[categoryId]=res.success;if(!res.success){return}
self.trigger('templatesLoaded',[categoryId])},})},insertTemplate:function(categoryId,templateId,parentId,currentIndex){var self=this;if(!categoryId){$usb.log('Error: Template category ID is not set',args);return}
if(!templateId){$usb.log('Error: Template ID is not set',args);return}
if(!$usb.builder.isMainContainer(parentId)){$usb.log('Error: Invalid parent container, templates can only be added to mainContainer',args);return}
var insert=$usb.builder.getInsertPosition(parentId,currentIndex);var _getTemplateData=function(){$usb.postMessage('showPreloader',[insert.parent,insert.position,]);$usb.builder._renderShortcode('templates.getTemplateData',{data:{template_category_id:categoryId,template_id:templateId,isReturnContent:!0},success:function(res){$usb.postMessage('hidePreloader',insert.parent);if(!res.success||!res.data.content||!res.data.html){return}
var firstElmId,html=''+res.data.html,content=res.data.content,customPrefix=$usb.config('designOptions.customPrefix','usb_custom_');content=content.replace(_REGEXP_USBID_ATTR_,function(match,input,elmId){var newElmId=$usb.builder.getSpareElmId(elmId);if(!firstElmId){firstElmId=newElmId}
html=html.replace(new RegExp('data-(for|usbid)="'+elmId+'"','g'),'data-$1="'+newElmId+'"').replace(new RegExp(customPrefix+elmId.replace(':',''),'g'),$ush.uniqid(customPrefix));return input.replace(elmId,newElmId)});if(!$usb.builder._addShortcodeToContent(parentId,currentIndex,content)){return!1}
$usb.postMessage('insertElm',[insert.parent,insert.position,html]);if($usb.builder.isRow(firstElmId)){$usb.history.commitChange(firstElmId,_CHANGED_ACTION_.CREATE)}
$usb.trigger('builder.contentChange')}})};if(!self.templateIsLoaded(categoryId)){self.off('templatesLoaded').one('templatesLoaded',function(_categoryId){if(categoryId==_categoryId){_getTemplateData()}});if(self.categoryIsLoaded(categoryId)){$usb.log('Error: Failed to load template category:',[categoryId])}
return}
_getTemplateData()}});$usb.templates=new Templates('#usb-templates')}(jQuery);!function($,undefined){var _window=window,_document=document;if(!_window.$usb){return}['$ush','$usbcore'].map(function(name){_window[name]=_window[name]||{}});var _$temp={isInputCustomCss:!1,pageFieldset:{},};function Page(){var self=this;self._events={changePageCustomCss:self._changePageCustomCss.bind(self),changePageMeta:self._changePageMeta.bind(self),changeSettings:self._changeSettings.bind(self),handlerClearBody:self._handlerClearBody.bind(self),iframeReady:self._iframeReady.bind(self),setParamsForSettings:self._setParamsForSettings.bind(self),showCustomCss:self._showCustomCss.bind(self),showSettings:self._showSettings.bind(self),urlManager:self._urlManager.bind(self),};$(function(){self.$pageSettings=$('.usb-panel-page-settings',$usb.$panel);self.$pageCustomCss=$('.usb-panel-page-custom-css',$usb.$panel);self.$actionShowCustomCss=$('.usb_action_show_page_custom_css',$usb.$panel);self.$actionShowSettings=$('.usb_action_show_page_settings',$usb.$panel);$usb.$panel.on('click','.usb_action_show_page_settings',self._events.showSettings).on('click','.usb_action_show_page_custom_css',self._events.showCustomCss);self._urlManager($usb.urlManager.getDataOfChange())});$usb.on('iframeReady',self._events.iframeReady).on('panel.clearBody',self._events.handlerClearBody).on('urlManager.changed',self._events.urlManager)}
var prototype=Page.prototype;$.extend(prototype,$ush.mixinEvents,{_urlManager:function(state){var self=this;if(!self.isReady()){return}
if(state.setParams.active=='page_settings'){self.showSettings()}
else if(state.setParams.active=='page_custom_css'){if(!$usb.iframeIsReady){$usb.one('iframeReady',self.showCustomCss.bind(self))}else{self.showCustomCss()}}},_iframeReady:function(){var self=this;if($usb.builder.pageData.customCss){self.$actionShowCustomCss.addClass('css_not_empty')}},_handlerClearBody:function(){var self=this;if(!self.isReady()){return}
self._hideSettings();self._hideCustomCss()}});$.extend(prototype,{isReady:function(){return!$ush.isUndefined(this.$pageSettings)},_showSettings:function(){$usb.urlManager.setParam('active','page_settings').push()},showSettings:function(){var self=this;if(!(_$temp.pageFieldset.pageFields instanceof $usof.GroupParams)){var pageFields=new $usof.GroupParams($('.for_page_fields',self.$pageSettings)[0]);for(var k in pageFields.fields){pageFields.fields[k].on('change',$ush.debounce(self._events.changeSettings,1))}
_$temp.pageFieldset.pageFields=pageFields}
if(!(_$temp.pageFieldset.pageMeta instanceof $usof.GroupParams)){var pageMeta=new $usof.GroupParams($('.usb-panel-page-meta',self.$pageSettings)[0]);for(var k in pageMeta.fields){pageMeta.fields[k].on('change',$ush.debounce(self._events.changePageMeta,1))}
_$temp.pageFieldset.pageMeta=pageMeta}
self._setParamsForSettings();$usb.panel.clearBody();$usb.navigator.resetActive();self.$pageSettings.removeClass('hidden');self.$actionShowSettings.addClass('active');$usb.panel.setTitle('page_settings',!0)},_hideSettings:function(){var self=this;self.$pageSettings.addClass('hidden');self.$actionShowSettings.removeClass('active')},_setParamsForSettings:function(){var self=this;if(!$usb.iframeIsReady){$usb.one('iframeReady',self._events.setParamsForSettings);self.$pageSettings.addClass('data_loading');return}
var pageData=$usb.builder.pageData,pageMeta=_$temp.pageFieldset.pageMeta,pageFields=_$temp.pageFieldset.pageFields;if(pageFields instanceof $usof.GroupParams){pageFields.setValues(pageData.fields,!0);$.extend(pageData.fields,pageFields.getValues())}
if(pageMeta instanceof $usof.GroupParams){pageMeta.setValues(pageData.pageMeta,!0);$.extend(pageData.pageMeta,pageMeta.getValues())}
self.$pageSettings.removeClass('data_loading')},_changeSettings:function(field,value){if(!(field instanceof $usof.field)){return}
var self=this,name=field.name;$usb.builder.pageData.fields[name]=value;if(name==='post_title'){_document.title=$usb.config('adminPageTitleMask',value).replace('%s',value);$usb.postMessage('updateElmContent',['.post_title,head > title',value,'text'])}
$ush.debounce_fn_1ms(function(){$usb.trigger('builder.contentChange')})},_changePageMeta:function(usofField){if(!(usofField instanceof $usof.field)){return}
var self=this,name=usofField.name,value=usofField.getValue();if($usb.builder.pageData.pageMeta[name]===value){return}
$usb.builder.pageData.pageMeta[name]=value;if((usofField.$row.data('usb-params')||{}).usb_preview){$usb.builder._isReloadPreviewAfterSave=!0}
$ush.debounce_fn_1ms(function(){$usb.trigger('builder.contentChange')})},_showCustomCss:function(){$usb.urlManager.setParam('active','page_custom_css').push()},showCustomCss:function(){var self=this;if(!$usb.iframeIsReady){$usb.off('iframeReady',self._events.showCustomCss).one('iframeReady',self._events.showCustomCss);return}
$usb.builderPanel._loadAssetsForCodeEditor();if(!(_$temp.pageFieldset.pageCustomCss instanceof $usof.field)){var pageCustomCss=new $usof.field($('.type_css',self.$pageCustomCss)[0]);pageCustomCss.init(pageCustomCss.$row);pageCustomCss.setValue($usb.builder.pageData.customCss);pageCustomCss.on('change',$ush.debounce(self._events.changePageCustomCss,1));_$temp.pageFieldset.pageCustomCss=pageCustomCss}
$usb.panel.clearBody();$usb.navigator.resetActive();self.$pageCustomCss.removeClass('hidden');self.$actionShowCustomCss.addClass('active');$usb.panel.setTitle('page_custom_css',!0);try{var cmInstance=_$temp.pageFieldset.pageCustomCss.editor.codemirror;cmInstance.focus();cmInstance.setCursor(cmInstance.lineCount(),0)}catch(err){}},_hideCustomCss:function(){var self=this;if(self.isReady()){self.$pageCustomCss.addClass('hidden');self.$actionShowCustomCss.removeClass('active')}},__debounce_2s:$ush.debounce($ush.fn,2000),_changePageCustomCss:function(usofField,pageCustomCss){var self=this;if($usb.hotkeys('ctrl+z','ctrl+shift+z')){return}
var setPageCustomCss=function(customCss,originalTask){if($.type(customCss)!=='string'||$usb.builder.pageData.customCss==customCss){return}
if($usb.history.isActiveRecoveryTask()&&$.isPlainObject(originalTask)){_$temp.pageFieldset.pageCustomCss.setValue(customCss);originalTask.data=''+$usb.builder.pageData.customCss}
$usb.builder.pageData.customCss=customCss;$usb.postMessage('updatePageCustomCss',customCss);$ush.debounce_fn_1ms(function(){$usb.trigger('builder.contentChange')});self.$actionShowCustomCss.toggleClass('css_not_empty',!!customCss)};if(!_$temp.isInputCustomCss){$usb.history.commitData($usb.builder.pageData.customCss,setPageCustomCss);_$temp.isInputCustomCss=!0}
else{self.__debounce_2s(function(){_$temp.isInputCustomCss=!1})}
setPageCustomCss(pageCustomCss)}});$usb.page=new Page}(jQuery);!function($,undefined){var _window=window;if(!_window.$usb){return}['$ush','$usbcore','$usof'].map(function(name){_window[name]=_window[name]||{}});const _HISTORY_TYPE_={REDO:'redo',UNDO:'undo'};var _$changesHistory={redo:[],tasks:[],undo:[]};var _$temp={isActiveRecoveryTask:!1,_latestShortcodeUpdates:{},};function History(){var self=this;self._events={historyChanged:self._historyChanged.bind(self),redoChange:self._redoChange.bind(self),undoChange:self._undoChange.bind(self),};$(function(){self.$actionUndo=$('.usb_action_undo',$usb.$panel);self.$actionRedo=$('.usb_action_redo',$usb.$panel);$usb.$panel.on('click','.usb_action_undo',self._events.undoChange).on('click','.usb_action_redo',self._events.redoChange)});$usb.on('hotkeys.ctrl+z',self._events.undoChange).on('hotkeys.ctrl+shift+z',self._events.redoChange);self.on('historyChanged',self._events.historyChanged)}
$.extend(History.prototype,$ush.mixinEvents,{_undoChange:function(){this._createRecoveryTask(_HISTORY_TYPE_.UNDO)},_redoChange:function(){this._createRecoveryTask(_HISTORY_TYPE_.REDO)},_historyChanged:function(){var self=this;[{$btn:self.$actionUndo,disabled:!self.getLengthUndo()},{$btn:self.$actionRedo,disabled:!self.getLengthRedo()}].map(function(i){i.$btn.toggleClass('recovery_process',!!self.getLengthTasks()).toggleClass('disabled',i.disabled).prop('disabled',i.disabled)})},getLengthUndo:function(){return _$changesHistory.undo.length},getLengthRedo:function(){return _$changesHistory.redo.length},getLengthTasks:function(){return _$changesHistory.tasks.length},getLastHistoryDataByAction:function(action){var lastData,self=this,undo=_$changesHistory.undo;if(self.getLengthUndo()&&$usbcore.indexOf(action,_CHANGED_ACTION_)>-1){for(var i=self.getLengthUndo()-1;i>=0;i--){if((undo[i]||{}).action===action){lastData=$ush.clone(undo[i]);break}}}
return lastData||{}},isActiveRecoveryTask:function(){return!!_$temp.isActiveRecoveryTask},__saveDataToHistory:$ush.throttle($ush.fn,2000,!0),commitChange:function(id,action,useThrottle,extData){var self=this;if(!action||!$usb.builder.isValidId(id)||self.isActiveRecoveryTask()||$usbcore.indexOf(action,_CHANGED_ACTION_)<0){return}
var saveDataToHistory=function(){var data={action:action,id:id,extData:$.isPlainObject(extData)?extData:{},};if($usbcore.indexOf(action,[_CHANGED_ACTION_.MOVE,_CHANGED_ACTION_.REMOVE])>-1){data.index=$usb.builder.getElmIndex(id);data.parentId=$usb.builder.getElmParentId(id)}
if($usbcore.indexOf(action,[_CHANGED_ACTION_.UPDATE,_CHANGED_ACTION_.REMOVE])>-1){data.content=$usb.builder.getElmShortcode(id);data.preview=$usb.builder.getElmOuterHtml(id);var pcre=new RegExp('class="(.*)?'+$usb.config('className.elmLoad','usb-elm-loading')+'(\s|")');if(data.preview&&pcre.test(data.preview)){return}}
if(_CHANGED_ACTION_.UPDATE===action&&!$.isEmptyObject(_$temp._latestShortcodeUpdates)){$.extend(data,_$temp._latestShortcodeUpdates);_$temp._latestShortcodeUpdates={}}
if(_CHANGED_ACTION_.REMOVE===action){data.values=$usb.builder.getElmValues(id)}
if(_CHANGED_ACTION_.UPDATE===action){var lastData=self.getLastHistoryDataByAction(_CHANGED_ACTION_.UPDATE);var props=['index','parentId','timestamp'];if(!$.isEmptyObject(lastData)&&$usbcore.comparePlainObject($usbcore.clearPlainObject(lastData,props),$usbcore.clearPlainObject(data,props))){return}}
if(self.getLengthUndo()>=$ush.parseInt($usb.config('maxDataHistory',100))){_$changesHistory.undo=_$changesHistory.undo.slice(1)}
_$changesHistory.undo.push($.extend(data,{timestamp:Date.now()}));_$changesHistory.redo=[];self.trigger('historyChanged')};if(!!useThrottle){self.__saveDataToHistory(saveDataToHistory)}else{saveDataToHistory()}},commitData:function(customData,callback,useThrottle){var self=this;if($ush.isUndefined(customData)||!$.isFunction(callback)){return}
var saveDataToHistory=function(){var data={action:_CHANGED_ACTION_.CALLBACK,callback:callback,data:customData};var lastData=self.getLastHistoryDataByAction(_CHANGED_ACTION_.CALLBACK);if(!$.isEmptyObject(lastData)&&$usbcore.comparePlainObject($usbcore.clearPlainObject(lastData,['callback','timestamp']),$usbcore.clearPlainObject(data,'callback'))){return}
if(self.getLengthUndo()>=$ush.parseInt($usb.config('maxDataHistory',100))){_$changesHistory.undo=_$changesHistory.undo.slice(1)}
_$changesHistory.undo.push($.extend(data,{timestamp:Date.now()}));_$changesHistory.redo=[];self.trigger('historyChanged')};if(!!useThrottle){self.__saveDataToHistory(saveDataToHistory)}else{saveDataToHistory()}},_createRecoveryTask:function(type){var self=this;if(!type||$usbcore.indexOf(type,[_HISTORY_TYPE_.UNDO,_HISTORY_TYPE_.REDO])<0){return}
var task,lengthUndo=self.getLengthUndo(),lengthRedo=self.getLengthRedo();if(type===_HISTORY_TYPE_.UNDO&&lengthUndo){task=_$changesHistory.undo[--lengthUndo];_$changesHistory.undo=_$changesHistory.undo.slice(0,lengthUndo)}
if(type===_HISTORY_TYPE_.REDO&&lengthRedo){task=_$changesHistory.redo[--lengthRedo];_$changesHistory.redo=_$changesHistory.redo.slice(0,lengthRedo)}
if(!$.isEmptyObject(task)){_$changesHistory.tasks.push($ush.clone(task,{_source:type}));self.trigger('historyChanged');self.__startRecoveryTasks.call(self)}},__startRecoveryTasks:$ush.debounce(function(){var self=this;if(self.isActiveRecoveryTask()){return}
_$temp.isActiveRecoveryTask=!0;self._recoveryTaskManager()},100),_recoveryTaskManager:function(){var self=this,lengthTasks=self.getLengthTasks(),task=_$changesHistory.tasks[--lengthTasks];if($.isEmptyObject(task)){_$temp.isActiveRecoveryTask=!1;self.trigger('historyChanged');return}
_$changesHistory.tasks=_$changesHistory.tasks.slice(0,lengthTasks);$ush.timeout(self._applyChangesFromTask.bind(self,$ush.clone(task),task),1);switch(task.action){case _CHANGED_ACTION_.CREATE:task.action=_CHANGED_ACTION_.REMOVE;break;case _CHANGED_ACTION_.REMOVE:task.action=_CHANGED_ACTION_.CREATE;break}
if($usbcore.indexOf(task.action,[_CHANGED_ACTION_.UPDATE,_CHANGED_ACTION_.REMOVE])>-1){task.content=$usb.builder.getElmShortcode(task.id);task.preview=$usb.builder.getElmOuterHtml(task.id)}
if($usbcore.indexOf(task.action,[_CHANGED_ACTION_.MOVE,_CHANGED_ACTION_.REMOVE])>-1){task.index=$usb.builder.getElmIndex(task.id);task.parentId=$usb.builder.getElmParentId(task.id)}
var _source=task._source;delete task._source;if(_source===_HISTORY_TYPE_.UNDO){_$changesHistory.redo.push(task)}else{_$changesHistory.undo.push(task)}},_applyChangesFromTask:function(task,originalTask){var self=this;if($.isEmptyObject(task)){_$temp.isActiveRecoveryTask=!1;return}
if(!task.action){$usb.log('Error: Invalid change action:',task);return}
if(task.action===_CHANGED_ACTION_.CREATE){$usb.builder.removeElm(task.id)}else if(task.action===_CHANGED_ACTION_.MOVE){$usb.builder.moveElm(task.id,task.parentId,task.index)}else if(task.action===_CHANGED_ACTION_.REMOVE){if(!$usb.builder._addShortcodeToContent(task.parentId,task.index,task.content)){return!1}
var insert=$usb.builder.getInsertPosition(task.parentId,task.index);$usb.postMessage('insertElm',[insert.parent,insert.position,''+task.preview]);$usb.postMessage('maybeInitElmJS',[task.id])}else if(task.action===_CHANGED_ACTION_.UPDATE){$usb.builder.pageData.content=(''+$usb.builder.pageData.content).replace($usb.builder.getElmShortcode(task.id),task.content);$usb.postMessage('updateSelectedElm',[task.id,''+task.preview]);var id=(task.extData||{}).originalId||task.id;if(id===$usb.builder.selectedElmId&&$usb.builderPanel.activeElmFieldset instanceof $usof.GroupParams){$usb.builderPanel.activeElmFieldset.setValues($usb.builder.getElmValues($usb.builder.selectedElmId),!0)}}else if(task.action===_CHANGED_ACTION_.CALLBACK){if($.isFunction(task.callback)){task.callback.call(self,$ush.clone(task).data,originalTask)}}else{$usb.log('Error: Unknown recovery action:',action);return}
if($usbcore.indexOf(task.action,[_CHANGED_ACTION_.UPDATE,_CHANGED_ACTION_.REMOVE])>-1){$usb.trigger('builder.contentChange')}
self.trigger('historyChanged');$ush.timeout(self._recoveryTaskManager.bind(self),1)}});$usb.history=new History}(jQuery);!function($,undefined){var _window=window;if(!_window.$usb){return}['$ush','$usbcore'].map(function(name){_window[name]=_window[name]||{}});var _$temp={fieldsets:{},isProcessSave:!1,savedLiveOptions:{},};function SiteSettings(container){var self=this;self.selectedGroupId;self.activeFieldset;self.$activeFieldset;if($usb.urlManager.hasParam('action',$usb.config('actions.site_settings'))){_window.onbeforeunload=function(e){$usb.postMessage('clearCookies')}}
self._events={changeField:self._changeField.bind(self),clickGoToBack:self._clickGoToBack.bind(self),clickGroupId:self._clickGroupId.bind(self),confirmExit:self._confirmExit.bind(self),handlerClearBody:self._handlerClearBody.bind(self),iframeReady:self._iframeReady.bind(self),saveChanges:self._saveChanges.bind(self),urlManager:self._urlManager.bind(self),};$(function(){self.$container=$(container);self.$menu=$('.usb-panel-site-settings-menu',$usb.$panel);self.$actionGoToBack=$('.usb_action_go_to_back',$usb.$panel);var $fieldsets=$('#usb-site-settings-fieldsets',self.$container);if($fieldsets.is('[onclick]')){_$temp.fieldsets=$fieldsets[0].onclick()||{};$fieldsets.remove()}
$usb.$panel.on('click','[data-group-id]',self._events.clickGroupId).on('click','.usb_action_go_to_back',self._events.clickGoToBack).on('click','a:not([target=_blank])',self._events.confirmExit);self._urlManager($usb.urlManager.getDataOfChange())});$usb.on('iframeReady',self._events.iframeReady).on('panel.clearBody',self._events.handlerClearBody).on('panel.saveChanges',self._events.saveChanges).on('hotkeys.ctrl+s',self._events.saveChanges).on('urlManager.changed',self._events.urlManager)}
var prototype=SiteSettings.prototype;$.extend(prototype,{_urlManager:function(state){var self=this,_siteSettings=$usb.config('actions.site_settings');if(!self.isReady()){return}
if(state.setParams.action===_siteSettings){var groupId=state.setParams.group;if(groupId&&self.selectedGroupId!==groupId){if(!$usb.iframeIsReady){$usb.panel.showPreloader();$usb.one('iframeReady',self.initFieldset.bind(self,groupId))}else{self.initFieldset(groupId)}}
else if(!groupId){self.showGeneralMenu()}
self.$actionGoToBack.toggleClass('disabled',!state.setParams.group)}
else if(state.oldParams.action===_siteSettings){self._handlerClearBody();_$temp.savedLiveOptions={};$usb.urlManager.removeParam('group').push()}},_confirmExit:function(e){var message=$usb.getTextTranslation('page_leave_warning');if(this.isChanged()&&!confirm(message)){e.preventDefault();return}},_iframeReady:function(){var self=this;if(!$usb.iframeIsReady||!$usb.urlManager.hasParam('action',$usb.config('actions.site_settings'))){return}
var iframeWindow=$usb.iframe.contentWindow;self.liveOptions=$ush.clone((iframeWindow.$usbdata||{}).liveOptions||{});if($.isEmptyObject(_$temp.savedLiveOptions)){_$temp.savedLiveOptions=$ush.clone(self.liveOptions)}
$usb.panel.hidePreloader()},_handlerClearBody:function(){var self=this;self._destroyFieldset();$usb.postMessage('clearCookies')}});$.extend(prototype,{isReady:function(){return!$ush.isUndefined(this.$container)},isChanged:function(){return!$usbcore.comparePlainObject(_$temp.savedLiveOptions,this.liveOptions||{})},isProcessSave:function(){return _$temp.isProcessSave},showGeneralMenu:function(){var self=this;if(!self.isReady()){return}
$usb.panel.setTitle('site_settings',!0);$usb.trigger('panel.clearBody');self.$menu.removeClass('hidden')},_clickGroupId:function(e){var groupId=$usbcore.$attr(e.currentTarget,'data-group-id');if(groupId){$usb.urlManager.setParam('group',groupId).push()}},_clickGoToBack:function(){$usb.urlManager.removeParam('group').push()},initFieldset:function(groupId){var self=this;if($ush.isUndefined(_$temp.fieldsets[groupId])){return}
self.$menu.addClass('hidden');var groupTitle=$usb.config('site.group_titles.'+groupId);if(groupTitle){$usb.panel.setTitle(groupTitle)}
self.$activeFieldset=$(_$temp.fieldsets[groupId]);$usb.$panelBody.prepend(self.$activeFieldset);self.selectedGroupId=groupId;self.activeFieldset=new $usof.GroupParams(self.$activeFieldset);self.$activeFieldset.addClass('inited usof-container');self.activeFieldset.setValues(self.liveOptions||{},!0);for(var fieldId in self.activeFieldset.fields){self.activeFieldset.fields[fieldId].on('change',self._events.changeField).on('syncResponsiveState',function(_,screenName){if($usb.find('preview')){$usb.preview.fieldSetResponsiveScreen(screenName)}})}},_destroyFieldset:function(){var self=this;if(!self.selectedGroupId){return}
if(self.$activeFieldset instanceof $){self.$activeFieldset.remove()}
self.$menu.addClass('hidden');self.activeFieldset=null;self.selectedGroupId=null},_changeField:function(usofField){var self=this;if($ush.isUndefined(self.liveOptions[usofField.name])){return}
var isGroup=usofField instanceof $usof.Group,isField=usofField instanceof $usof.field;if(!(isField||isGroup)){return}
var value=usofField.getValue(),fieldType=(isField?usofField.type:'group'),usbParams=usofField[isField?'$row':'$field'].data('usb-params')||{},instructions=$usb._normalizeInstructions(usbParams.usb_preview);if(fieldType=='typography_options'){value=$ush.toPlainObject(value)}
var oldValue=self.liveOptions[usofField.name];if($.isPlainObject(value)){if($usbcore.comparePlainObject(oldValue,value)){return}}else if(oldValue===value){return}
self.liveOptions[usofField.name]=value;if(instructions){var _changed=JSON.stringify($usbcore.diffPlainObject(self.liveOptions,_$temp.savedLiveOptions));$usb.postMessage('onPreviewChange',[instructions,value,fieldType,{changed:$ush.base64Encode(_changed),liveOptions:$ush.toString(self.liveOptions)}])}
$ush.debounce_fn_10ms(function(){$usb.panel.switchSaveButton(self.isChanged())})},_saveChanges:function(){var self=this;if(self.isProcessSave()||!self.isChanged()||!$usb.urlManager.hasParam('action',$usb.config('actions.site_settings'))){return}
$usb.panel.switchSaveButton(!0,!0);_$temp.isProcessSave=!0;$usb.ajax('_saveLiveOptions',{data:{_nonce:$usb.config('_nonce'),action:$usb.config('action_save_live_options'),live_options:JSON.stringify(self.liveOptions)},success:function(res){if(!res.success){return}
$usb.notify.add($usb.getTextTranslation('site_settings_updated'),_NOTIFY_TYPE_.SUCCESS);$usb.postMessage('clearCookies');_$temp.savedLiveOptions=$ush.clone(self.liveOptions)},complete:function(){_$temp.isProcessSave=!1;$usb.panel.switchSaveButton(!1)}})}});$usb.siteSettings=new SiteSettings('#usb-site-settings')}(jQuery)