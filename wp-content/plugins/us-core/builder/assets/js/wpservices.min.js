!function($,undefined){var _window=window,_document=document,_location=location,_undefined=undefined;['wp','$usbdata'].map(function(name){_window[name]=_window[name]||{}});function USHeartbeat(){var self=this;self._events={send_refreshLock:self._send_refreshLock.bind(self),tick_refreshLock:self._tick_refreshLock.bind(self),};$(_document).on('heartbeat-send.refresh-lock',self._events.send_refreshLock).on('heartbeat-tick.refresh-lock',self._events.tick_refreshLock);wp.heartbeat.interval(15)};$.extend(USHeartbeat.prototype,{_send_refreshLock:function(e,data){var post_id=_window.$usbdata.post_id||0;if(post_id){data['wp-refresh-post-lock']={post_id:post_id}}},_tick_refreshLock:function(e,data){var $dialog=$('#post-lock-dialog');if(!data['wp-refresh-post-lock']||!$dialog.length){return}
var received=data['wp-refresh-post-lock'];if(received.lock_error){if(received.lock_error.avatar_src&&!$dialog.is(':visible')){var $avatar=$('<img />',{'class':'avatar avatar-64 photo',width:64,height:64,alt:'',src:received.lock_error.avatar_src,srcset:received.lock_error.avatar_src_2x?received.lock_error.avatar_src_2x+' 2x':_undefined});$('div.post-locked-avatar',$dialog).empty().append($avatar)}
var $dialogText=$('.currently-editing',$dialog);if(!$dialogText.text()&&received.lock_error.text){$dialogText.text(received.lock_error.text)}
$dialog.removeClass('hidden').show();$('.wp-tab-first',$dialog).trigger('focus')}
else if(received.new_lock){if($dialog.is(':visible')){_location.reload()}}}});new USHeartbeat}(jQuery)